{"version":3,"file":"dataset-search-widget.min.js","sources":["../src/jsx/dataset-search-widget.jsx"],"sourcesContent":["/**\n * @file\n * Dataset search widget using @dkan-client-tools/react package.\n * JSX source file - compiled to js/dataset-search-widget.js\n */\n\n// Import everything from DKAN Client Tools React (which includes React internally)\nimport {\n  DkanClient,\n  QueryClient,\n  DkanClientProvider,\n  useDatasetSearch,\n  React,\n  ReactDOM,\n} from '@dkan-client-tools/react';\n\n(function (Drupal, once) {\n  'use strict';\n\n  /**\n   * Drupal behavior for DKAN React dataset search widget.\n   */\n  Drupal.behaviors.dkanReactDatasetSearchWidget = {\n    attach(context, settings) {\n      const elements = once('dkan-react-dataset-search', '#dkan-react-dataset-search-widget', context);\n\n      elements.forEach((element) => {\n        // Get settings from Drupal\n        const widgetSettings = settings.dkanClientDemoReact || {};\n        const baseUrl = widgetSettings.baseUrl || '/';\n\n        // Create root and render React app\n        const root = ReactDOM.createRoot(element);\n        root.render(<DatasetSearchWidget baseUrl={baseUrl} />);\n      });\n    }\n  };\n\n  /**\n   * Dataset Search Widget React Component.\n   */\n  function DatasetSearchWidget({ baseUrl }) {\n    // Create DkanClient instance with QueryClient\n    const [client] = React.useState(() => {\n      // First create a QueryClient from React Query\n      const queryClient = new QueryClient({\n        defaultOptions: {\n          queries: {\n            staleTime: 5 * 60 * 1000,\n            gcTime: 10 * 60 * 1000,\n            retry: 1,\n          },\n        },\n      });\n\n      // Then create DkanClient with the QueryClient\n      return new DkanClient({\n        baseUrl,\n        queryClient,\n      });\n    });\n\n    // Wrap app in DkanClientProvider\n    return (\n      <DkanClientProvider client={client}>\n        <DatasetSearchApp />\n      </DkanClientProvider>\n    );\n  }\n\n  /**\n   * Main Dataset Search App Component.\n   */\n  function DatasetSearchApp() {\n    const [searchTerm, setSearchTerm] = React.useState('');\n    const [page, setPage] = React.useState(1);\n    const [expandedCard, setExpandedCard] = React.useState(null);\n    const pageSize = 10;\n\n    // Use dataset search for both searching and browsing\n    // Pass fulltext only when there's a search term, otherwise it shows all datasets\n    const { data, isLoading, isError, error } = useDatasetSearch({\n      searchOptions: {\n        fulltext: searchTerm || undefined,\n        page,\n        'page-size': pageSize,\n      },\n      enabled: true,\n    });\n\n    const datasets = data?.results || [];\n    const totalResults = data?.total || 0;\n    const totalPages = Math.ceil(totalResults / pageSize);\n\n    // Handle search input\n    const handleSearchChange = (e) => {\n      setSearchTerm(e.target.value);\n      setPage(1);\n      setExpandedCard(null);\n    };\n\n    // Handle pagination\n    const handlePrevPage = () => {\n      if (page > 1) {\n        setPage(page - 1);\n        setExpandedCard(null);\n      }\n    };\n\n    const handleNextPage = () => {\n      if (page < totalPages) {\n        setPage(page + 1);\n        setExpandedCard(null);\n      }\n    };\n\n    // Toggle card expansion\n    const toggleCard = (identifier) => {\n      setExpandedCard(expandedCard === identifier ? null : identifier);\n    };\n\n    return (\n      <div className=\"dkan-widget-container\">\n        <Header />\n        <div className=\"dkan-widget-body\">\n          <SearchBox value={searchTerm} onChange={handleSearchChange} />\n          {isLoading && <Loading />}\n          {isError && <Error message={error?.message} />}\n          {!isLoading && !isError && (\n            <Results\n              datasets={datasets}\n              totalResults={totalResults}\n              page={page}\n              totalPages={totalPages}\n              expandedCard={expandedCard}\n              onToggleCard={toggleCard}\n              onPrevPage={handlePrevPage}\n              onNextPage={handleNextPage}\n            />\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Header Component.\n   */\n  function Header() {\n    return (\n      <header className=\"dkan-widget-header\">\n        <h2>DKAN Dataset Search (React)</h2>\n        <p>Demonstrating @dkan-client-tools/react in Drupal</p>\n      </header>\n    );\n  }\n\n  /**\n   * Search Box Component.\n   */\n  function SearchBox({ value, onChange }) {\n    return (\n      <div className=\"search-box\">\n        <input\n          type=\"text\"\n          className=\"search-input\"\n          placeholder=\"Search datasets...\"\n          value={value}\n          onChange={onChange}\n        />\n      </div>\n    );\n  }\n\n  /**\n   * Loading Component.\n   */\n  function Loading() {\n    return <div className=\"loading\">Loading datasets...</div>;\n  }\n\n  /**\n   * Error Component.\n   */\n  function Error({ message }) {\n    return <div className=\"error\">Error: {message}</div>;\n  }\n\n  /**\n   * Results Component.\n   */\n  function Results({ datasets, totalResults, page, totalPages, expandedCard, onToggleCard, onPrevPage, onNextPage }) {\n    if (datasets.length === 0) {\n      return (\n        <div className=\"results\">\n          <div className=\"no-results\">No datasets found.</div>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"results\">\n        <div className=\"results-info\">\n          Found {totalResults} datasets (Page {page} of {totalPages || 1})\n        </div>\n        <div className=\"dataset-items\">\n          {datasets.map(dataset => (\n            <DatasetCard\n              key={dataset.identifier}\n              dataset={dataset}\n              isExpanded={expandedCard === dataset.identifier}\n              onToggle={() => onToggleCard(dataset.identifier)}\n            />\n          ))}\n        </div>\n        {totalPages > 1 && (\n          <Pagination\n            page={page}\n            totalPages={totalPages}\n            onPrevPage={onPrevPage}\n            onNextPage={onNextPage}\n          />\n        )}\n      </div>\n    );\n  }\n\n  /**\n   * Dataset Card Component.\n   */\n  function DatasetCard({ dataset, isExpanded, onToggle }) {\n    const description = dataset.description || '';\n    const truncatedDesc = description.substring(0, 200) + (description.length > 200 ? '...' : '');\n\n    return (\n      <div\n        className={`dataset-card ${isExpanded ? 'expanded' : ''}`}\n        onClick={onToggle}\n      >\n        <div className=\"card-header\">\n          <h3>{dataset.title}</h3>\n          <span className=\"expand-icon\">{isExpanded ? 'âˆ’' : '+'}</span>\n        </div>\n        {description && (\n          <p className=\"description\">\n            {isExpanded ? description : truncatedDesc}\n          </p>\n        )}\n        <div className=\"metadata\">\n          <span className=\"tag\">{dataset.accessLevel}</span>\n          {dataset.modified && (\n            <span className=\"modified\">\n              Modified: {new Date(dataset.modified).toLocaleDateString()}\n            </span>\n          )}\n        </div>\n        {dataset.keyword && dataset.keyword.length > 0 && (\n          <div className=\"keywords\">\n            {dataset.keyword.map((keyword, idx) => (\n              <span key={idx} className=\"keyword\">{keyword}</span>\n            ))}\n          </div>\n        )}\n        {isExpanded && <ExpandedDetails dataset={dataset} />}\n      </div>\n    );\n  }\n\n  /**\n   * Expanded Details Component.\n   */\n  function ExpandedDetails({ dataset }) {\n    return (\n      <div className=\"expanded-details\">\n        {dataset.identifier && (\n          <DetailRow label=\"Identifier\" value={dataset.identifier} />\n        )}\n        {dataset.publisher && (\n          <DetailRow label=\"Publisher\" value={dataset.publisher.name} />\n        )}\n        {dataset.theme && dataset.theme.length > 0 && (\n          <DetailRow label=\"Theme\" value={dataset.theme.join(', ')} />\n        )}\n        {dataset.issued && (\n          <DetailRow label=\"Issued\" value={new Date(dataset.issued).toLocaleDateString()} />\n        )}\n        {dataset.contactPoint && (\n          <DetailRow\n            label=\"Contact\"\n            value={`${dataset.contactPoint.fn}${dataset.contactPoint.hasEmail ? ` (${dataset.contactPoint.hasEmail.replace('mailto:', '')})` : ''}`}\n          />\n        )}\n        {dataset.distribution && dataset.distribution.length > 0 && (\n          <div className=\"detail-row\">\n            <strong>Distributions:</strong>\n            <div className=\"distributions\">\n              {dataset.distribution.map((dist, idx) => (\n                <div key={idx} className=\"distribution-item\">\n                  <span className=\"distribution-title\">\n                    {dist.title || `Distribution ${idx + 1}`}\n                  </span>\n                  {dist.format && (\n                    <span className=\"distribution-format\">{dist.format}</span>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n        {dataset.license && (\n          <div className=\"detail-row\">\n            <strong>License:</strong>\n            <a href={dataset.license} target=\"_blank\" rel=\"noopener noreferrer\">\n              {dataset.license}\n            </a>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  /**\n   * Detail Row Component.\n   */\n  function DetailRow({ label, value }) {\n    return (\n      <div className=\"detail-row\">\n        <strong>{label}:</strong>\n        <span>{value}</span>\n      </div>\n    );\n  }\n\n  /**\n   * Pagination Component.\n   */\n  function Pagination({ page, totalPages, onPrevPage, onNextPage }) {\n    return (\n      <div className=\"pagination\">\n        <button\n          className=\"prev-btn\"\n          disabled={page === 1}\n          onClick={onPrevPage}\n        >\n          Previous\n        </button>\n        <span className=\"page-info\">Page {page} of {totalPages}</span>\n        <button\n          className=\"next-btn\"\n          disabled={page === totalPages}\n          onClick={onNextPage}\n        >\n          Next\n        </button>\n      </div>\n    );\n  }\n\n})(window.Drupal, window.once);\n"],"names":["Drupal","once","DatasetSearchWidget","baseUrl","client","React","useState","queryClient","QueryClient","defaultOptions","queries","staleTime","gcTime","retry","DkanClient","createElement","DkanClientProvider","DatasetSearchApp","searchTerm","setSearchTerm","page","setPage","expandedCard","setExpandedCard","data","isLoading","isError","error","useDatasetSearch","searchOptions","fulltext","enabled","datasets","results","totalResults","total","totalPages","Math","ceil","className","Header","SearchBox","value","onChange","e","target","Loading","Error","message","Results","onToggleCard","identifier","onPrevPage","onNextPage","type","placeholder","length","map","dataset","DatasetCard","key","isExpanded","onToggle","Pagination","description","truncatedDesc","substring","onClick","title","accessLevel","modified","Date","toLocaleDateString","keyword","idx","ExpandedDetails","DetailRow","label","publisher","name","theme","join","issued","contactPoint","fn","hasEmail","replace","distribution","dist","format","license","href","rel","disabled","behaviors","dkanReactDatasetSearchWidget","attach","context","settings","forEach","element","dkanClientDemoReact","ReactDOM","createRoot","render","window"],"mappings":"2BAcO,SAEIA,EAAQC,GAyBjB,SAASC,GAAoBC,QAAEA,IAE7B,MAAOC,GAAUC,EAAAA,MAAMC,SAAS,KAE9B,MAAMC,EAAc,IAAIC,cAAY,CAClCC,eAAgB,CACdC,QAAS,CACPC,UAAW,IACXC,OAAQ,IACRC,MAAO,MAMb,OAAO,IAAIC,EAAAA,WAAW,CACpBX,UACAI,kBAKJ,OACEF,EAAAA,MAAAU,cAACC,EAAAA,mBAAA,CAAmBZ,UAClBC,EAAAA,MAAAU,cAACE,QAGP,CAKA,SAASA,IACP,MAAOC,EAAYC,GAAiBd,EAAAA,MAAMC,SAAS,KAC5Cc,EAAMC,GAAWhB,EAAAA,MAAMC,SAAS,IAChCgB,EAAcC,GAAmBlB,EAAAA,MAAMC,SAAS,OAKjDkB,KAAEA,EAAAC,UAAMA,EAAAC,QAAWA,QAASC,GAAUC,EAAAA,iBAAiB,CAC3DC,cAAe,CACbC,SAAUZ,QAAc,EACxBE,OACA,YARa,IAUfW,SAAS,IAGLC,EAAWR,GAAMS,SAAW,GAC5BC,EAAeV,GAAMW,OAAS,EAC9BC,EAAaC,KAAKC,KAAKJ,EAfZ,IA4CjB,OACE7B,EAAAA,MAAAU,cAAC,MAAA,CAAIwB,UAAU,+CACZC,EAAA,MACDnC,QAAAU,cAAC,MAAA,CAAIwB,UAAU,oBACblC,QAAAU,cAAC0B,EAAA,CAAUC,MAAOxB,EAAYyB,SA9BRC,IAC1BzB,EAAcyB,EAAEC,OAAOH,OACvBrB,EAAQ,GACRE,EAAgB,SA4BXE,GAAapB,EAAAA,MAAAU,cAAC+B,EAAA,MACdpB,GAAWrB,EAAAA,MAAAU,cAACgC,EAAA,CAAMC,QAASrB,GAAOqB,WACjCvB,IAAcC,GACdrB,EAAAA,MAAAU,cAACkC,EAAA,CACCjB,WACAE,eACAd,OACAgB,aACAd,eACA4B,aAlBUC,IAClB5B,EAAgBD,IAAiB6B,EAAa,KAAOA,IAkB7CC,WAlCa,KACjBhC,EAAO,IACTC,EAAQD,EAAO,GACfG,EAAgB,QAgCV8B,WA5Ba,KACjBjC,EAAOgB,IACTf,EAAQD,EAAO,GACfG,EAAgB,WA+BtB,CAKA,SAASiB,IACP,OACEnC,EAAAA,MAAAU,cAAC,SAAA,CAAOwB,UAAU,sBAChBlC,EAAAA,MAAAU,cAAC,KAAA,KAAG,+BACJV,EAAAA,MAAAU,cAAC,IAAA,KAAE,oDAGT,CAKA,SAAS0B,GAAUC,MAAEA,EAAAC,SAAOA,IAC1B,OACEtC,EAAAA,MAAAU,cAAC,MAAA,CAAIwB,UAAU,cACblC,EAAAA,MAAAU,cAAC,QAAA,CACCuC,KAAK,OACLf,UAAU,eACVgB,YAAY,qBACZb,QACAC,aAIR,CAKA,SAASG,IACP,OAAOzC,EAAAA,MAAAU,cAAC,MAAA,CAAIwB,UAAU,WAAU,sBAClC,CAKA,SAASQ,GAAMC,QAAEA,IACf,OAAO3C,EAAAA,MAAAU,cAAC,MAAA,CAAIwB,UAAU,SAAQ,UAAQS,EACxC,CAKA,SAASC,GAAQjB,SAAEA,EAAAE,aAAUA,EAAAd,KAAcA,EAAAgB,WAAMA,eAAYd,EAAA4B,aAAcA,EAAAE,WAAcA,EAAAC,WAAYA,IACnG,OAAwB,IAApBrB,EAASwB,SAETnD,MAAAU,cAAC,OAAIwB,UAAU,iCACZ,MAAA,CAAIA,UAAU,cAAa,yBAMhClC,MAAAU,cAAC,OAAIwB,UAAU,iCACZ,MAAA,CAAIA,UAAU,gBAAe,SACrBL,EAAa,mBAAiBd,EAAK,OAAKgB,GAAc,EAAE,KAEjE/B,EAAAA,MAAAU,cAAC,OAAIwB,UAAU,iBACZP,EAASyB,IAAIC,KACZrD,MAAAU,cAAC4C,EAAA,CACCC,IAAKF,EAAQP,WACbO,UACAG,WAAYvC,IAAiBoC,EAAQP,WACrCW,SAAU,IAAMZ,EAAaQ,EAAQP,gBAI1Cf,EAAa,KACZ/B,MAAAU,cAACgD,EAAA,CACC3C,OACAgB,aACAgB,aACAC,eAKV,CAKA,SAASM,GAAYD,QAAEA,EAAAG,WAASA,EAAAC,SAAYA,IAC1C,MAAME,EAAcN,EAAQM,aAAe,GACrCC,EAAgBD,EAAYE,UAAU,EAAG,MAAQF,EAAYR,OAAS,IAAM,MAAQ,IAE1F,SACEnD,MAAAU,cAAC,MAAA,CACCwB,UAAW,iBAAgBsB,EAAa,WAAa,IACrDM,QAASL,yBAER,MAAA,CAAIvB,UAAU,eACblC,QAAAU,cAAC,UAAI2C,EAAQU,OACb/D,EAAAA,MAAAU,cAAC,QAAKwB,UAAU,eAAesB,EAAa,IAAM,MAEnDG,GACC3D,EAAAA,MAAAU,cAAC,IAAA,CAAEwB,UAAU,eACVsB,EAAaG,EAAcC,KAGhC5D,MAAAU,cAAC,MAAA,CAAIwB,UAAU,YACblC,EAAAA,MAAAU,cAAC,QAAKwB,UAAU,OAAOmB,EAAQW,aAC9BX,EAAQY,UACPjE,EAAAA,MAAAU,cAAC,OAAA,CAAKwB,UAAU,YAAW,aACd,IAAIgC,KAAKb,EAAQY,UAAUE,uBAI3Cd,EAAQe,SAAWf,EAAQe,QAAQjB,OAAS,GAC3CnD,QAAAU,cAAC,MAAA,CAAIwB,UAAU,YACZmB,EAAQe,QAAQhB,IAAI,CAACgB,EAASC,IAC7BrE,EAAAA,MAAAU,cAAC,OAAA,CAAK6C,IAAKc,EAAKnC,UAAU,WAAWkC,KAI1CZ,GAAcxD,EAAAA,MAAAU,cAAC4D,EAAA,CAAgBjB,YAGtC,CAKA,SAASiB,GAAgBjB,QAAEA,IACzB,SACErD,MAAAU,cAAC,MAAA,CAAIwB,UAAU,oBACZmB,EAAQP,cACP9C,MAAAU,cAAC6D,EAAA,CAAUC,MAAM,aAAanC,MAAOgB,EAAQP,aAE9CO,EAAQoB,WACPzE,EAAAA,MAAAU,cAAC6D,EAAA,CAAUC,MAAM,YAAYnC,MAAOgB,EAAQoB,UAAUC,OAEvDrB,EAAQsB,OAAStB,EAAQsB,MAAMxB,OAAS,GACvCnD,EAAAA,MAAAU,cAAC6D,EAAA,CAAUC,MAAM,QAAQnC,MAAOgB,EAAQsB,MAAMC,KAAK,QAEpDvB,EAAQwB,QACP7E,EAAAA,MAAAU,cAAC6D,EAAA,CAAUC,MAAM,SAASnC,MAAO,IAAI6B,KAAKb,EAAQwB,QAAQV,uBAE3Dd,EAAQyB,gBACP9E,MAAAU,cAAC6D,EAAA,CACCC,MAAM,UACNnC,MAAO,GAAGgB,EAAQyB,aAAaC,KAAK1B,EAAQyB,aAAaE,SAAW,KAAK3B,EAAQyB,aAAaE,SAASC,QAAQ,UAAW,OAAS,OAGtI5B,EAAQ6B,cAAgB7B,EAAQ6B,aAAa/B,OAAS,GACrDnD,EAAAA,MAAAU,cAAC,MAAA,CAAIwB,UAAU,cACblC,EAAAA,MAAAU,cAAC,SAAA,KAAO,wCACP,MAAA,CAAIwB,UAAU,iBACZmB,EAAQ6B,aAAa9B,IAAI,CAAC+B,EAAMd,0BAC9B,MAAA,CAAId,IAAKc,EAAKnC,UAAU,qBACvBlC,QAAAU,cAAC,OAAA,CAAKwB,UAAU,sBACbiD,EAAKpB,OAAS,gBAAgBM,EAAM,KAEtCc,EAAKC,QACJpF,EAAAA,MAAAU,cAAC,QAAKwB,UAAU,uBAAuBiD,EAAKC,YAOvD/B,EAAQgC,SACPrF,QAAAU,cAAC,MAAA,CAAIwB,UAAU,cACblC,EAAAA,MAAAU,cAAC,SAAA,KAAO,kCACP,IAAA,CAAE4E,KAAMjC,EAAQgC,QAAS7C,OAAO,SAAS+C,IAAI,uBAC3ClC,EAAQgC,UAMrB,CAKA,SAASd,GAAUC,MAAEA,EAAAnC,MAAOA,IAC1B,OACErC,EAAAA,MAAAU,cAAC,MAAA,CAAIwB,UAAU,cACblC,EAAAA,MAAAU,cAAC,SAAA,KAAQ8D,EAAM,KACfxE,EAAAA,MAAAU,cAAC,OAAA,KAAM2B,GAGb,CAKA,SAASqB,GAAW3C,KAAEA,EAAAgB,WAAMA,EAAAgB,WAAYA,EAAAC,WAAYA,IAClD,OACEhD,EAAAA,MAAAU,cAAC,MAAA,CAAIwB,UAAU,cACblC,EAAAA,MAAAU,cAAC,SAAA,CACCwB,UAAU,WACVsD,SAAmB,IAATzE,EACV+C,QAASf,GACV,kCAGA,OAAA,CAAKb,UAAU,aAAY,QAAMnB,EAAK,OAAKgB,KAC5C/B,MAAAU,cAAC,SAAA,CACCwB,UAAU,WACVsD,SAAUzE,IAASgB,EACnB+B,QAASd,GACV,QAKP,CA9UArD,EAAO8F,UAAUC,6BAA+B,CAC9C,MAAAC,CAAOC,EAASC,GACGjG,EAAK,4BAA6B,oCAAqCgG,GAE/EE,QAASC,IAEhB,MACMjG,GADiB+F,EAASG,qBAAuB,CAAA,GACxBlG,SAAW,IAG7BmG,EAAAA,SAASC,WAAWH,GAC5BI,eAAOzF,cAACb,EAAA,CAAoBC,cAErC,EAmUJ,CAxVO,CAwVJsG,OAAOzG,OAAQyG,OAAOxG"}