var DkanClientTools=(function(exports){'use strict';/* @dkan-client-tools/core - Minified IIFE build for browsers and Drupal */
var It=r=>{throw TypeError(r)};var Rt=(r,t,e)=>t.has(r)||It("Cannot "+e);var i=(r,t,e)=>(Rt(r,t,"read from private field"),e?e.call(r):t.get(r)),l=(r,t,e)=>t.has(r)?It("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),h=(r,t,e,s)=>(Rt(r,t,"write to private field"),t.set(r,e),e),v=(r,t,e)=>(Rt(r,t,"access private method"),e);var pt=(r,t,e,s)=>({set _(a){h(r,t,a);},get _(){return i(r,t,s)}});var S=class extends Error{constructor(e,s,a){super(e);this.statusCode=s;this.response=a;this.name="DkanApiError";}};var dt=class{constructor(t){this.baseUrl=t.baseUrl.replace(/\/$/,""),t.auth&&("token"in t.auth&&t.auth.token?this.auth={token:t.auth.token}:"username"in t.auth&&"password"in t.auth&&t.auth.username&&t.auth.password&&(this.auth={username:t.auth.username,password:t.auth.password})),this.defaultOptions={retry:t.defaultOptions?.retry??3,retryDelay:t.defaultOptions?.retryDelay??1e3,staleTime:t.defaultOptions?.staleTime??0,cacheTime:t.defaultOptions?.cacheTime??300*1e3};}getAuthHeader(){if(this.auth){if("token"in this.auth)return `Bearer ${this.auth.token}`;if("username"in this.auth&&"password"in this.auth)return `Basic ${btoa(`${this.auth.username}:${this.auth.password}`)}`}}async request(t,e={},s=0){let a=`${this.baseUrl}${t}`,o=this.getAuthHeader(),c={"Content-Type":"application/json",...e.headers};o&&(c.Authorization=o);try{let n=await fetch(a,{...e,headers:c});if(!n.ok){let p=await n.text();throw new S(`HTTP ${n.status}: ${n.statusText}`,n.status,p)}return {data:await n.json(),status:n.status,statusText:n.statusText}}catch(n){if(s<this.defaultOptions.retry)return await new Promise(u=>setTimeout(u,this.defaultOptions.retryDelay*(s+1))),this.request(t,e,s+1);throw n instanceof S?n:new S(n instanceof Error?n.message:"Unknown error occurred")}}async getDataset(t){return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}`)).data}async searchDatasets(t={}){let e=new URLSearchParams;t.keyword&&e.append("keyword",t.keyword),t.theme&&e.append("theme",t.theme),t.fulltext&&e.append("fulltext",t.fulltext),t.sort&&e.append("sort",t.sort),t["sort-order"]&&e.append("sort-order",t["sort-order"]),t.page!==void 0&&e.append("page",t.page.toString()),t["page-size"]!==void 0&&e.append("page-size",t["page-size"].toString());let s=e.toString(),a=`/api/1/search${s?`?${s}`:""}`,c=(await this.request(a)).data,n=[];return c.results&&typeof c.results=="object"&&(n=Object.values(c.results)),{total:typeof c.total=="string"?parseInt(c.total,10):c.total,results:n,facets:c.facets}}async queryDatastore(t,e=0,s={}){return (await this.request(`/api/1/datastore/query/${t}/${e}`,{method:"POST",body:JSON.stringify(s)})).data}async getDatastoreSchema(t,e=0){return (await this.request(`/api/1/datastore/query/${t}/${e}?schema=true`)).data}async listDataDictionaries(){let t=await this.request("/api/1/metastore/schemas/data-dictionary/items");return t.data&&Array.isArray(t.data)?t.data:t.data&&typeof t.data=="object"?Object.values(t.data):[]}async getDataDictionary(t){return (await this.request(`/api/1/metastore/schemas/data-dictionary/items/${t}`)).data}async getDataDictionaryFromUrl(t){try{let e=await fetch(t);if(!e.ok)throw new S(`HTTP ${e.status}: ${e.statusText}`,e.status);return await e.json()}catch(e){throw e instanceof S?e:new S(e instanceof Error?e.message:"Failed to fetch data dictionary")}}async listAllDatasets(){let t=await this.request("/api/1/metastore/schemas/dataset/items");return t.data&&Array.isArray(t.data)?t.data:t.data&&typeof t.data=="object"?Object.values(t.data):[]}async listSchemas(){let t=await this.request("/api/1/metastore/schemas");return Array.isArray(t.data)?t.data:typeof t.data=="object"?Object.keys(t.data):[]}async getSchemaItems(t){let e=await this.request(`/api/1/metastore/schemas/${t}/items`);return e.data&&Array.isArray(e.data)?e.data:e.data&&typeof e.data=="object"?Object.values(e.data):[]}async getDatasetFacets(){let t=await this.listAllDatasets(),e=new Set,s=new Set,a=new Set;return t.forEach(o=>{o.theme&&o.theme.forEach(c=>e.add(c)),o.keyword&&o.keyword.forEach(c=>s.add(c)),o.publisher?.name&&a.add(o.publisher.name);}),{theme:Array.from(e).sort(),keyword:Array.from(s).sort(),publisher:Array.from(a).sort()}}async listDatasets(){return (await this.request("/api/3/action/package_list")).data}async getDatasetCkan(t){return (await this.request(`/api/3/action/package_show?id=${t}`)).data.result}getBaseUrl(){return this.baseUrl}getDefaultOptions(){return {...this.defaultOptions}}async listHarvestPlans(){return (await this.request("/api/1/harvest/plans")).data}async registerHarvestPlan(t){return (await this.request("/api/1/harvest/plans",{method:"POST",body:JSON.stringify(t)})).data}async getHarvestPlan(t){return (await this.request(`/api/1/harvest/plans/${t}`)).data}async listHarvestRuns(t){return (await this.request(`/api/1/harvest/runs?plan=${t}`)).data}async getHarvestRun(t){return (await this.request(`/api/1/harvest/runs/${t}`)).data}async runHarvest(t){return (await this.request("/api/1/harvest/runs",{method:"POST",body:JSON.stringify(t)})).data}async createDataset(t){return (await this.request("/api/1/metastore/schemas/dataset/items",{method:"POST",body:JSON.stringify(t)})).data}async updateDataset(t,e){return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}`,{method:"PUT",body:JSON.stringify(e)})).data}async patchDataset(t,e){return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}`,{method:"PATCH",body:JSON.stringify(e)})).data}async deleteDataset(t){return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}`,{method:"DELETE"})).data}async listDatastoreImports(){return (await this.request("/api/1/datastore/imports")).data}async triggerDatastoreImport(t){return (await this.request("/api/1/datastore/imports",{method:"POST",body:JSON.stringify(t)})).data}async deleteDatastore(t){return (await this.request(`/api/1/datastore/imports/${t}`,{method:"DELETE"})).data}async getRevisions(t,e){return (await this.request(`/api/1/metastore/schemas/${t}/items/${e}/revisions`)).data}async getRevision(t,e,s){return (await this.request(`/api/1/metastore/schemas/${t}/items/${e}/revisions/${s}`)).data}async createRevision(t,e,s){return (await this.request(`/api/1/metastore/schemas/${t}/items/${e}/revisions`,{method:"POST",body:JSON.stringify(s)})).data}async changeDatasetState(t,e,s){return this.createRevision("dataset",t,{state:e,message:s})}async downloadQuery(t,e,s={}){let a=s.format||"csv",o={...s};delete o.format;let c=new URLSearchParams({format:a});if(Object.keys(o).length>0)for(let[y,b]of Object.entries(o))b!==void 0&&c.append(y,typeof b=="string"?b:JSON.stringify(b));let n=`${this.baseUrl}/api/1/datastore/query/${t}/${e}/download?${c.toString()}`,u=this.getAuthHeader(),p={};u&&(p.Authorization=u);let d=await fetch(n,{method:"GET",headers:p});if(!d.ok)throw new S(`HTTP ${d.status}: ${d.statusText}`,d.status);return await d.blob()}async downloadQueryByDistribution(t,e={}){let s=e.format||"csv",a={...e};delete a.format;let o=new URLSearchParams({format:s});if(Object.keys(a).length>0)for(let[d,y]of Object.entries(a))y!==void 0&&o.append(d,typeof y=="string"?y:JSON.stringify(y));let c=`${this.baseUrl}/api/1/datastore/query/${t}/download?${o.toString()}`,n=this.getAuthHeader(),u={};n&&(u.Authorization=n);let p=await fetch(c,{method:"GET",headers:u});if(!p.ok)throw new S(`HTTP ${p.status}: ${p.statusText}`,p.status);return await p.blob()}async querySql(t){if((t.method||"GET")==="GET"){let s=new URLSearchParams({query:t.query});return t.show_db_columns&&s.append("show_db_columns","true"),(await this.request(`/api/1/datastore/sql?${s.toString()}`,{method:"GET"})).data}else return (await this.request("/api/1/datastore/sql",{method:"POST",body:JSON.stringify({query:t.query,show_db_columns:t.show_db_columns})})).data}async createDataDictionary(t){return (await this.request("/api/1/metastore/schemas/data-dictionary/items",{method:"POST",body:JSON.stringify(t)})).data}async updateDataDictionary(t,e){return (await this.request(`/api/1/metastore/schemas/data-dictionary/items/${t}`,{method:"PUT",body:JSON.stringify(e)})).data}async deleteDataDictionary(t){return (await this.request(`/api/1/metastore/schemas/data-dictionary/items/${t}`,{method:"DELETE"})).data}getOpenApiDocsUrl(){return `${this.baseUrl}/api/1/docs`}};var Qt=class{constructor(t){this.mountCount=0;if(!t.queryClient)throw new Error("DkanClient requires a QueryClient. Create one using your framework adapter (e.g., @tanstack/vue-query) and pass it to DkanClient.");this.apiClient=new dt(t),this.queryClient=t.queryClient;}getApiClient(){return this.apiClient}getQueryClient(){return this.queryClient}mount(){this.mountCount++,this.mountCount===1&&this.queryClient.mount();}unmount(){this.mountCount--,this.mountCount===0&&this.queryClient.unmount();}isMounted(){return this.mountCount>0}async fetchDataset(t){return this.apiClient.getDataset(t)}async searchDatasets(t){return this.apiClient.searchDatasets(t)}async queryDatastore(t,e,s){return this.apiClient.queryDatastore(t,e,s)}async getDatastoreSchema(t,e){return this.apiClient.getDatastoreSchema(t,e)}async listDataDictionaries(){return this.apiClient.listDataDictionaries()}async getDataDictionary(t){return this.apiClient.getDataDictionary(t)}async getDataDictionaryFromUrl(t){return this.apiClient.getDataDictionaryFromUrl(t)}async listAllDatasets(){return this.apiClient.listAllDatasets()}async listSchemas(){return this.apiClient.listSchemas()}async getSchemaItems(t){return this.apiClient.getSchemaItems(t)}async getDatasetFacets(){return this.apiClient.getDatasetFacets()}async prefetchQuery(t,e,s){await this.queryClient.prefetchQuery({queryKey:t,queryFn:e,staleTime:s?.staleTime});}getQueryData(t){return this.queryClient.getQueryData(t)}setQueryData(t,e){this.queryClient.setQueryData(t,e);}async invalidateQueries(t){await this.queryClient.invalidateQueries({queryKey:t});}clear(){this.queryClient.clear();}removeQueries(t){this.queryClient.removeQueries({queryKey:t});}getQueryCache(){return this.queryClient.getQueryCache()}async listHarvestPlans(){return this.apiClient.listHarvestPlans()}async registerHarvestPlan(t){return this.apiClient.registerHarvestPlan(t)}async getHarvestPlan(t){return this.apiClient.getHarvestPlan(t)}async listHarvestRuns(t){return this.apiClient.listHarvestRuns(t)}async getHarvestRun(t){return this.apiClient.getHarvestRun(t)}async runHarvest(t){return this.apiClient.runHarvest(t)}async createDataset(t){return this.apiClient.createDataset(t)}async updateDataset(t,e){return this.apiClient.updateDataset(t,e)}async patchDataset(t,e){return this.apiClient.patchDataset(t,e)}async deleteDataset(t){return this.apiClient.deleteDataset(t)}async listDatastoreImports(){return this.apiClient.listDatastoreImports()}async triggerDatastoreImport(t){return this.apiClient.triggerDatastoreImport(t)}async deleteDatastore(t){return this.apiClient.deleteDatastore(t)}async getRevisions(t,e){return this.apiClient.getRevisions(t,e)}async getRevision(t,e,s){return this.apiClient.getRevision(t,e,s)}async createRevision(t,e,s){return this.apiClient.createRevision(t,e,s)}async changeDatasetState(t,e,s){return this.apiClient.changeDatasetState(t,e,s)}async downloadQuery(t,e,s){return this.apiClient.downloadQuery(t,e,s)}async downloadQueryByDistribution(t,e){return this.apiClient.downloadQueryByDistribution(t,e)}async querySql(t){return this.apiClient.querySql(t)}async createDataDictionary(t){return this.apiClient.createDataDictionary(t)}async updateDataDictionary(t,e){return this.apiClient.updateDataDictionary(t,e)}async deleteDataDictionary(t){return this.apiClient.deleteDataDictionary(t)}getOpenApiDocsUrl(){return this.apiClient.getOpenApiDocsUrl()}};var I=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this);}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe();}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}};var de={setTimeout:(r,t)=>setTimeout(r,t),clearTimeout:r=>clearTimeout(r),setInterval:(r,t)=>setInterval(r,t),clearInterval:r=>clearInterval(r)},x,B,jt,fe=(jt=class{constructor(){l(this,x,de);l(this,B,false);}setTimeoutProvider(r){process.env.NODE_ENV!=="production"&&i(this,B)&&r!==i(this,x)&&console.error("[timeoutManager]: Switching provider after calls to previous provider might result in unexpected behavior.",{previous:i(this,x),provider:r}),h(this,x,r),process.env.NODE_ENV!=="production"&&h(this,B,false);}setTimeout(r,t){return process.env.NODE_ENV!=="production"&&h(this,B,true),i(this,x).setTimeout(r,t)}clearTimeout(r){i(this,x).clearTimeout(r);}setInterval(r,t){return process.env.NODE_ENV!=="production"&&h(this,B,true),i(this,x).setInterval(r,t)}clearInterval(r){i(this,x).clearInterval(r);}},x=new WeakMap,B=new WeakMap,jt),ft=new fe;function $t(r){setTimeout(r,0);}var j=typeof window>"u"||"Deno"in globalThis;function P(){}function Kt(r,t){return typeof r=="function"?r(t):r}function _t(r){return typeof r=="number"&&r>=0&&r!==1/0}function Lt(r,t){return Math.max(r+(t||0)-Date.now(),0)}function yt(r,t){return typeof r=="function"?r(t):r}function Wt(r,t){return typeof r=="function"?r(t):r}function Mt(r,t){let{type:e="all",exact:s,fetchStatus:a,predicate:o,queryKey:c,stale:n}=r;if(c){if(s){if(t.queryHash!==mt(c,t.options))return  false}else if(!et(t.queryKey,c))return  false}if(e!=="all"){let u=t.isActive();if(e==="active"&&!u||e==="inactive"&&u)return  false}return !(typeof n=="boolean"&&t.isStale()!==n||a&&a!==t.state.fetchStatus||o&&!o(t))}function At(r,t){let{exact:e,status:s,predicate:a,mutationKey:o}=r;if(o){if(!t.options.mutationKey)return  false;if(e){if(Y(t.options.mutationKey)!==Y(o))return  false}else if(!et(t.options.mutationKey,o))return  false}return !(s&&t.state.status!==s||a&&!a(t))}function mt(r,t){return (t?.queryKeyHashFn||Y)(r)}function Y(r){return JSON.stringify(r,(t,e)=>Tt(e)?Object.keys(e).sort().reduce((s,a)=>(s[a]=e[a],s),{}):e)}function et(r,t){return r===t?true:typeof r!=typeof t?false:r&&t&&typeof r=="object"&&typeof t=="object"?Object.keys(t).every(e=>et(r[e],t[e])):false}var ye=Object.prototype.hasOwnProperty;function xt(r,t){if(r===t)return r;let e=Ut(r)&&Ut(t);if(!e&&!(Tt(r)&&Tt(t)))return t;let a=(e?r:Object.keys(r)).length,o=e?t:Object.keys(t),c=o.length,n=e?new Array(c):{},u=0;for(let p=0;p<c;p++){let d=e?p:o[p],y=r[d],b=t[d];if(y===b){n[d]=y,(e?p<a:ye.call(r,d))&&u++;continue}if(y===null||b===null||typeof y!="object"||typeof b!="object"){n[d]=b;continue}let H=xt(y,b);n[d]=H,H===y&&u++;}return a===c&&u===a?r:n}function Ut(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function Tt(r){if(!Nt(r))return  false;let t=r.constructor;if(t===void 0)return  true;let e=t.prototype;return !(!Nt(e)||!e.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function Nt(r){return Object.prototype.toString.call(r)==="[object Object]"}function Bt(r){return new Promise(t=>{ft.setTimeout(t,r);})}function Gt(r,t,e){if(typeof e.structuralSharing=="function")return e.structuralSharing(r,t);if(e.structuralSharing!==false){if(process.env.NODE_ENV!=="production")try{return xt(r,t)}catch(s){throw console.error(`Structural sharing requires data to be JSON serializable. To fix this, turn off structuralSharing or return JSON-serializable data from your queryFn. [${e.queryHash}]: ${s}`),s}return xt(r,t)}return t}function Jt(r,t,e=0){let s=[...r,t];return e&&s.length>e?s.slice(1):s}function zt(r,t,e=0){let s=[t,...r];return e&&s.length>e?s.slice(0,-1):s}var tt=Symbol();function Ct(r,t){return process.env.NODE_ENV!=="production"&&r.queryFn===tt&&console.error(`Attempted to invoke queryFn when set to skipToken. This is likely a configuration error. Query hash: '${r.queryHash}'`),!r.queryFn&&t?.initialPromise?()=>t.initialPromise:!r.queryFn||r.queryFn===tt?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var G,$,rt,Vt,me=(Vt=class extends I{constructor(){super();l(this,G);l(this,$);l(this,rt);h(this,rt,t=>{if(!j&&window.addEventListener){let e=()=>t();return window.addEventListener("visibilitychange",e,false),()=>{window.removeEventListener("visibilitychange",e);}}});}onSubscribe(){i(this,$)||this.setEventListener(i(this,rt));}onUnsubscribe(){var t;this.hasListeners()||((t=i(this,$))==null||t.call(this),h(this,$,void 0));}setEventListener(t){var e;h(this,rt,t),(e=i(this,$))==null||e.call(this),h(this,$,t(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus();}));}setFocused(t){i(this,G)!==t&&(h(this,G,t),this.onFocus());}onFocus(){let t=this.isFocused();this.listeners.forEach(e=>{e(t);});}isFocused(){return typeof i(this,G)=="boolean"?i(this,G):globalThis.document?.visibilityState!=="hidden"}},G=new WeakMap,$=new WeakMap,rt=new WeakMap,Vt),Pt=new me;function Zt(){let r,t,e=new Promise((a,o)=>{r=a,t=o;});e.status="pending",e.catch(()=>{});function s(a){Object.assign(e,a),delete e.resolve,delete e.reject;}return e.resolve=a=>{s({status:"fulfilled",value:a}),r(a);},e.reject=a=>{s({status:"rejected",reason:a}),t(a);},e}var ge=$t;function De(){let r=[],t=0,e=n=>{n();},s=n=>{n();},a=ge,o=n=>{t?r.push(n):a(()=>{e(n);});},c=()=>{let n=r;r=[],n.length&&a(()=>{s(()=>{n.forEach(u=>{e(u);});});});};return {batch:n=>{let u;t++;try{u=n();}finally{t--,t||c();}return u},batchCalls:n=>(...u)=>{o(()=>{n(...u);});},schedule:o,setNotifyFunction:n=>{e=n;},setBatchNotifyFunction:n=>{s=n;},setScheduler:n=>{a=n;}}}var g=De();var st,U,it,Xt,ve=(Xt=class extends I{constructor(){super();l(this,st,true);l(this,U);l(this,it);h(this,it,t=>{if(!j&&window.addEventListener){let e=()=>t(true),s=()=>t(false);return window.addEventListener("online",e,false),window.addEventListener("offline",s,false),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s);}}});}onSubscribe(){i(this,U)||this.setEventListener(i(this,it));}onUnsubscribe(){var t;this.hasListeners()||((t=i(this,U))==null||t.call(this),h(this,U,void 0));}setEventListener(t){var e;h(this,it,t),(e=i(this,U))==null||e.call(this),h(this,U,t(this.setOnline.bind(this)));}setOnline(t){i(this,st)!==t&&(h(this,st,t),this.listeners.forEach(s=>{s(t);}));}isOnline(){return i(this,st)}},st=new WeakMap,U=new WeakMap,it=new WeakMap,Xt),at=new ve;function be(r){return Math.min(1e3*2**r,3e4)}function Ft(r){return (r??"online")==="online"?at.isOnline():true}var Ot=class extends Error{constructor(r){super("CancelledError"),this.revert=r?.revert,this.silent=r?.silent;}};function St(r){let t=false,e=0,s,a=Zt(),o=()=>a.status!=="pending",c=m=>{if(!o()){let O=new Ot(m);b(O),r.onCancel?.(O);}},n=()=>{t=true;},u=()=>{t=false;},p=()=>Pt.isFocused()&&(r.networkMode==="always"||at.isOnline())&&r.canRun(),d=()=>Ft(r.networkMode)&&r.canRun(),y=m=>{o()||(s?.(),a.resolve(m));},b=m=>{o()||(s?.(),a.reject(m));},H=()=>new Promise(m=>{s=O=>{(o()||p())&&m(O);},r.onPause?.();}).then(()=>{s=void 0,o()||r.onContinue?.();}),w=()=>{if(o())return;let m,O=e===0?r.initialPromise:void 0;try{m=O??r.fn();}catch(Q){m=Promise.reject(Q);}Promise.resolve(m).then(y).catch(Q=>{if(o())return;let W=r.retry??(j?0:3),lt=r.retryDelay??be,bt=typeof lt=="function"?lt(e,Q):lt,wt=W===true||typeof W=="number"&&e<W||typeof W=="function"&&W(e,Q);if(t||!wt){b(Q);return}e++,r.onFail?.(e,Q),Bt(bt).then(()=>p()?void 0:H()).then(()=>{t?b(Q):w();});});};return {promise:a,status:()=>a.status,cancel:c,continue:()=>(s?.(),a),cancelRetry:n,continueRetry:u,canStart:d,start:()=>(d()?w():H().then(w),a)}}var J,Yt,qt=(Yt=class{constructor(){l(this,J);}destroy(){this.clearGcTimeout();}scheduleGc(){this.clearGcTimeout(),_t(this.gcTime)&&h(this,J,ft.setTimeout(()=>{this.optionalRemove();},this.gcTime));}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(j?1/0:300*1e3));}clearGcTimeout(){i(this,J)&&(ft.clearTimeout(i(this,J)),h(this,J,void 0));}},J=new WeakMap,Yt);var z,nt,q,V,D,gt,Z,k,F,re,se=(re=class extends qt{constructor(t){super();l(this,k);l(this,z);l(this,nt);l(this,q);l(this,V);l(this,D);l(this,gt);l(this,Z);h(this,Z,false),h(this,gt,t.defaultOptions),this.setOptions(t.options),this.observers=[],h(this,V,t.client),h(this,q,i(this,V).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,h(this,z,ee(this.options)),this.state=t.state??i(this,z),this.scheduleGc();}get meta(){return this.options.meta}get promise(){return i(this,D)?.promise}setOptions(t){if(this.options={...i(this,gt),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){let e=ee(this.options);e.data!==void 0&&(this.setState(te(e.data,e.dataUpdatedAt)),h(this,z,e));}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&i(this,q).remove(this);}setData(t,e){let s=Gt(this.state.data,t,this.options);return v(this,k,F).call(this,{data:s,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),s}setState(t,e){v(this,k,F).call(this,{type:"setState",state:t,setStateOptions:e});}cancel(t){let e=i(this,D)?.promise;return i(this,D)?.cancel(t),e?e.then(P).catch(P):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:true});}reset(){this.destroy(),this.setState(i(this,z));}isActive(){return this.observers.some(t=>Wt(t.options.enabled,this)!==false)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===tt||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>yt(t.options.staleTime,this)==="static"):false}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?true:t==="static"?false:this.state.isInvalidated?true:!Lt(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:false}),i(this,D)?.continue();}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:false}),i(this,D)?.continue();}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),i(this,q).notify({type:"observerAdded",query:this,observer:t}));}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(i(this,D)&&(i(this,Z)?i(this,D).cancel({revert:true}):i(this,D).cancelRetry()),this.scheduleGc()),i(this,q).notify({type:"observerRemoved",query:this,observer:t}));}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||v(this,k,F).call(this,{type:"invalidate"});}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&i(this,D)?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:true});else if(i(this,D))return i(this,D).continueRetry(),i(this,D).promise}if(t&&this.setOptions(t),!this.options.queryFn){let u=this.observers.find(p=>p.options.queryFn);u&&this.setOptions(u.options);}process.env.NODE_ENV!=="production"&&(Array.isArray(this.options.queryKey)||console.error("As of v4, queryKey needs to be an Array. If you are using a string like 'repoData', please change it to an Array, e.g. ['repoData']"));let s=new AbortController,a=u=>{Object.defineProperty(u,"signal",{enumerable:true,get:()=>(h(this,Z,true),s.signal)});},o=()=>{let u=Ct(this.options,e),d=(()=>{let y={client:i(this,V),queryKey:this.queryKey,meta:this.meta};return a(y),y})();return h(this,Z,false),this.options.persister?this.options.persister(u,d,this):u(d)},n=(()=>{let u={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:i(this,V),state:this.state,fetchFn:o};return a(u),u})();this.options.behavior?.onFetch(n,this),h(this,nt,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==n.fetchOptions?.meta)&&v(this,k,F).call(this,{type:"fetch",meta:n.fetchOptions?.meta}),h(this,D,St({initialPromise:e?.initialPromise,fn:n.fetchFn,onCancel:u=>{u instanceof Ot&&u.revert&&this.setState({...i(this,nt),fetchStatus:"idle"}),s.abort();},onFail:(u,p)=>{v(this,k,F).call(this,{type:"failed",failureCount:u,error:p});},onPause:()=>{v(this,k,F).call(this,{type:"pause"});},onContinue:()=>{v(this,k,F).call(this,{type:"continue"});},retry:n.options.retry,retryDelay:n.options.retryDelay,networkMode:n.options.networkMode,canRun:()=>true}));try{let u=await i(this,D).start();if(u===void 0)throw process.env.NODE_ENV!=="production"&&console.error(`Query data cannot be undefined. Please make sure to return a value other than undefined from your query function. Affected query key: ${this.queryHash}`),new Error(`${this.queryHash} data is undefined`);return this.setData(u),i(this,q).config.onSuccess?.(u,this),i(this,q).config.onSettled?.(u,this.state.error,this),u}catch(u){if(u instanceof Ot){if(u.silent)return i(this,D).promise;if(u.revert){if(this.state.data===void 0)throw u;return this.state.data}}throw v(this,k,F).call(this,{type:"error",error:u}),i(this,q).config.onError?.(u,this),i(this,q).config.onSettled?.(this.state.data,u,this),u}finally{this.scheduleGc();}}},z=new WeakMap,nt=new WeakMap,q=new WeakMap,V=new WeakMap,D=new WeakMap,gt=new WeakMap,Z=new WeakMap,k=new WeakSet,F=function(t){let e=s=>{switch(t.type){case "failed":return {...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case "pause":return {...s,fetchStatus:"paused"};case "continue":return {...s,fetchStatus:"fetching"};case "fetch":return {...s,...we(s.data,this.options),fetchMeta:t.meta??null};case "success":let a={...s,...te(t.data,t.dataUpdatedAt),dataUpdateCount:s.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return h(this,nt,t.manual?a:void 0),a;case "error":let o=t.error;return {...s,error:o,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case "invalidate":return {...s,isInvalidated:true};case "setState":return {...s,...t.state}}};this.state=e(this.state),g.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate();}),i(this,q).notify({query:this,type:"updated",action:t});});},re);function we(r,t){return {fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Ft(t.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function te(r,t){return {data:r,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:false,status:"success"}}function ee(r){let t=typeof r.initialData=="function"?r.initialData():r.initialData,e=t!==void 0,s=e?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return {data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:false,status:e?"success":"pending",fetchStatus:"idle"}}function Et(r){return {onFetch:(t,e)=>{let s=t.options,a=t.fetchOptions?.meta?.fetchMore?.direction,o=t.state.data?.pages||[],c=t.state.data?.pageParams||[],n={pages:[],pageParams:[]},u=0,p=async()=>{let d=false,y=w=>{Object.defineProperty(w,"signal",{enumerable:true,get:()=>(t.signal.aborted?d=true:t.signal.addEventListener("abort",()=>{d=true;}),t.signal)});},b=Ct(t.options,t.fetchOptions),H=async(w,m,O)=>{if(d)return Promise.reject();if(m==null&&w.pages.length)return Promise.resolve(w);let W=(()=>{let Ht={client:t.client,queryKey:t.queryKey,pageParam:m,direction:O?"backward":"forward",meta:t.options.meta};return y(Ht),Ht})(),lt=await b(W),{maxPages:bt}=t.options,wt=O?zt:Jt;return {pages:wt(w.pages,lt,bt),pageParams:wt(w.pageParams,m,bt)}};if(a&&o.length){let w=a==="backward",m=w?Ce:ie,O={pages:o,pageParams:c},Q=m(s,O);n=await H(O,Q,w);}else {let w=r??o.length;do{let m=u===0?c[0]??s.initialPageParam:ie(s,n);if(u>0&&m==null)break;n=await H(n,m),u++;}while(u<w)}return n};t.options.persister?t.fetchFn=()=>t.options.persister?.(p,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},e):t.fetchFn=p;}}}function ie(r,{pages:t,pageParams:e}){let s=t.length-1;return t.length>0?r.getNextPageParam(t[s],t,e[s],e):void 0}function Ce(r,{pages:t,pageParams:e}){return t.length>0?r.getPreviousPageParam?.(t[0],t,e[0],e):void 0}var Dt,T,C,X,M,N,ae,ne=(ae=class extends qt{constructor(t){super();l(this,M);l(this,Dt);l(this,T);l(this,C);l(this,X);h(this,Dt,t.client),this.mutationId=t.mutationId,h(this,C,t.mutationCache),h(this,T,[]),this.state=t.state||Pe(),this.setOptions(t.options),this.scheduleGc();}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime);}get meta(){return this.options.meta}addObserver(t){i(this,T).includes(t)||(i(this,T).push(t),this.clearGcTimeout(),i(this,C).notify({type:"observerAdded",mutation:this,observer:t}));}removeObserver(t){h(this,T,i(this,T).filter(e=>e!==t)),this.scheduleGc(),i(this,C).notify({type:"observerRemoved",mutation:this,observer:t});}optionalRemove(){i(this,T).length||(this.state.status==="pending"?this.scheduleGc():i(this,C).remove(this));}continue(){return i(this,X)?.continue()??this.execute(this.state.variables)}async execute(t){let e=()=>{v(this,M,N).call(this,{type:"continue"});},s={client:i(this,Dt),meta:this.options.meta,mutationKey:this.options.mutationKey};h(this,X,St({fn:()=>this.options.mutationFn?this.options.mutationFn(t,s):Promise.reject(new Error("No mutationFn found")),onFail:(c,n)=>{v(this,M,N).call(this,{type:"failed",failureCount:c,error:n});},onPause:()=>{v(this,M,N).call(this,{type:"pause"});},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>i(this,C).canRun(this)}));let a=this.state.status==="pending",o=!i(this,X).canStart();try{if(a)e();else {v(this,M,N).call(this,{type:"pending",variables:t,isPaused:o}),await i(this,C).config.onMutate?.(t,this,s);let n=await this.options.onMutate?.(t,s);n!==this.state.context&&v(this,M,N).call(this,{type:"pending",context:n,variables:t,isPaused:o});}let c=await i(this,X).start();return await i(this,C).config.onSuccess?.(c,t,this.state.context,this,s),await this.options.onSuccess?.(c,t,this.state.context,s),await i(this,C).config.onSettled?.(c,null,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(c,null,t,this.state.context,s),v(this,M,N).call(this,{type:"success",data:c}),c}catch(c){try{throw await i(this,C).config.onError?.(c,t,this.state.context,this,s),await this.options.onError?.(c,t,this.state.context,s),await i(this,C).config.onSettled?.(void 0,c,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(void 0,c,t,this.state.context,s),c}finally{v(this,M,N).call(this,{type:"error",error:c});}}finally{i(this,C).runNext(this);}}},Dt=new WeakMap,T=new WeakMap,C=new WeakMap,X=new WeakMap,M=new WeakSet,N=function(t){let e=s=>{switch(t.type){case "failed":return {...s,failureCount:t.failureCount,failureReason:t.error};case "pause":return {...s,isPaused:true};case "continue":return {...s,isPaused:false};case "pending":return {...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case "success":return {...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:false};case "error":return {...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:false,status:"error"}}};this.state=e(this.state),g.batch(()=>{i(this,T).forEach(s=>{s.onMutationUpdate(t);}),i(this,C).notify({mutation:this,type:"updated",action:t});});},ae);function Pe(){return {context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:false,status:"idle",variables:void 0,submittedAt:0}}var E,R,vt,oe,ue=(oe=class extends I{constructor(t={}){super();l(this,E);l(this,R);l(this,vt);this.config=t,h(this,E,new Set),h(this,R,new Map),h(this,vt,0);}build(t,e,s){let a=new ne({client:t,mutationCache:this,mutationId:++pt(this,vt)._,options:t.defaultMutationOptions(e),state:s});return this.add(a),a}add(t){i(this,E).add(t);let e=kt(t);if(typeof e=="string"){let s=i(this,R).get(e);s?s.push(t):i(this,R).set(e,[t]);}this.notify({type:"added",mutation:t});}remove(t){if(i(this,E).delete(t)){let e=kt(t);if(typeof e=="string"){let s=i(this,R).get(e);if(s)if(s.length>1){let a=s.indexOf(t);a!==-1&&s.splice(a,1);}else s[0]===t&&i(this,R).delete(e);}}this.notify({type:"removed",mutation:t});}canRun(t){let e=kt(t);if(typeof e=="string"){let a=i(this,R).get(e)?.find(o=>o.state.status==="pending");return !a||a===t}else return  true}runNext(t){let e=kt(t);return typeof e=="string"?i(this,R).get(e)?.find(a=>a!==t&&a.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){g.batch(()=>{i(this,E).forEach(t=>{this.notify({type:"removed",mutation:t});}),i(this,E).clear(),i(this,R).clear();});}getAll(){return Array.from(i(this,E))}find(t){let e={exact:true,...t};return this.getAll().find(s=>At(e,s))}findAll(t={}){return this.getAll().filter(e=>At(t,e))}notify(t){g.batch(()=>{this.listeners.forEach(e=>{e(t);});});}resumePausedMutations(){let t=this.getAll().filter(e=>e.state.isPaused);return g.batch(()=>Promise.all(t.map(e=>e.continue().catch(P))))}},E=new WeakMap,R=new WeakMap,vt=new WeakMap,oe);function kt(r){return r.options.scope?.id}var A,ce,he=(ce=class extends I{constructor(t={}){super();l(this,A);this.config=t,h(this,A,new Map);}build(t,e,s){let a=e.queryKey,o=e.queryHash??mt(a,e),c=this.get(o);return c||(c=new se({client:t,queryKey:a,queryHash:o,options:t.defaultQueryOptions(e),state:s,defaultOptions:t.getQueryDefaults(a)}),this.add(c)),c}add(t){i(this,A).has(t.queryHash)||(i(this,A).set(t.queryHash,t),this.notify({type:"added",query:t}));}remove(t){let e=i(this,A).get(t.queryHash);e&&(t.destroy(),e===t&&i(this,A).delete(t.queryHash),this.notify({type:"removed",query:t}));}clear(){g.batch(()=>{this.getAll().forEach(t=>{this.remove(t);});});}get(t){return i(this,A).get(t)}getAll(){return [...i(this,A).values()]}find(t){let e={exact:true,...t};return this.getAll().find(s=>Mt(e,s))}findAll(t={}){let e=this.getAll();return Object.keys(t).length>0?e.filter(s=>Mt(t,s)):e}notify(t){g.batch(()=>{this.listeners.forEach(e=>{e(t);});});}onFocus(){g.batch(()=>{this.getAll().forEach(t=>{t.onFocus();});});}onOnline(){g.batch(()=>{this.getAll().forEach(t=>{t.onOnline();});});}},A=new WeakMap,ce);var f,K,_,ot,ut,L,ct,ht,le,pe=(le=class{constructor(r={}){l(this,f);l(this,K);l(this,_);l(this,ot);l(this,ut);l(this,L);l(this,ct);l(this,ht);h(this,f,r.queryCache||new he),h(this,K,r.mutationCache||new ue),h(this,_,r.defaultOptions||{}),h(this,ot,new Map),h(this,ut,new Map),h(this,L,0);}mount(){pt(this,L)._++,i(this,L)===1&&(h(this,ct,Pt.subscribe(async r=>{r&&(await this.resumePausedMutations(),i(this,f).onFocus());})),h(this,ht,at.subscribe(async r=>{r&&(await this.resumePausedMutations(),i(this,f).onOnline());})));}unmount(){var r,t;pt(this,L)._--,i(this,L)===0&&((r=i(this,ct))==null||r.call(this),h(this,ct,void 0),(t=i(this,ht))==null||t.call(this),h(this,ht,void 0));}isFetching(r){return i(this,f).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return i(this,K).findAll({...r,status:"pending"}).length}getQueryData(r){let t=this.defaultQueryOptions({queryKey:r});return i(this,f).get(t.queryHash)?.state.data}ensureQueryData(r){let t=this.defaultQueryOptions(r),e=i(this,f).build(this,t),s=e.state.data;return s===void 0?this.fetchQuery(r):(r.revalidateIfStale&&e.isStaleByTime(yt(t.staleTime,e))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(r){return i(this,f).findAll(r).map(({queryKey:t,state:e})=>{let s=e.data;return [t,s]})}setQueryData(r,t,e){let s=this.defaultQueryOptions({queryKey:r}),o=i(this,f).get(s.queryHash)?.state.data,c=Kt(t,o);if(c!==void 0)return i(this,f).build(this,s).setData(c,{...e,manual:true})}setQueriesData(r,t,e){return g.batch(()=>i(this,f).findAll(r).map(({queryKey:s})=>[s,this.setQueryData(s,t,e)]))}getQueryState(r){let t=this.defaultQueryOptions({queryKey:r});return i(this,f).get(t.queryHash)?.state}removeQueries(r){let t=i(this,f);g.batch(()=>{t.findAll(r).forEach(e=>{t.remove(e);});});}resetQueries(r,t){let e=i(this,f);return g.batch(()=>(e.findAll(r).forEach(s=>{s.reset();}),this.refetchQueries({type:"active",...r},t)))}cancelQueries(r,t={}){let e={revert:true,...t},s=g.batch(()=>i(this,f).findAll(r).map(a=>a.cancel(e)));return Promise.all(s).then(P).catch(P)}invalidateQueries(r,t={}){return g.batch(()=>(i(this,f).findAll(r).forEach(e=>{e.invalidate();}),r?.refetchType==="none"?Promise.resolve():this.refetchQueries({...r,type:r?.refetchType??r?.type??"active"},t)))}refetchQueries(r,t={}){let e={...t,cancelRefetch:t.cancelRefetch??true},s=g.batch(()=>i(this,f).findAll(r).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let o=a.fetch(void 0,e);return e.throwOnError||(o=o.catch(P)),a.state.fetchStatus==="paused"?Promise.resolve():o}));return Promise.all(s).then(P)}fetchQuery(r){let t=this.defaultQueryOptions(r);t.retry===void 0&&(t.retry=false);let e=i(this,f).build(this,t);return e.isStaleByTime(yt(t.staleTime,e))?e.fetch(t):Promise.resolve(e.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(P).catch(P)}fetchInfiniteQuery(r){return r.behavior=Et(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(P).catch(P)}ensureInfiniteQueryData(r){return r.behavior=Et(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return at.isOnline()?i(this,K).resumePausedMutations():Promise.resolve()}getQueryCache(){return i(this,f)}getMutationCache(){return i(this,K)}getDefaultOptions(){return i(this,_)}setDefaultOptions(r){h(this,_,r);}setQueryDefaults(r,t){i(this,ot).set(Y(r),{queryKey:r,defaultOptions:t});}getQueryDefaults(r){let t=[...i(this,ot).values()],e={};return t.forEach(s=>{et(r,s.queryKey)&&Object.assign(e,s.defaultOptions);}),e}setMutationDefaults(r,t){i(this,ut).set(Y(r),{mutationKey:r,defaultOptions:t});}getMutationDefaults(r){let t=[...i(this,ut).values()],e={};return t.forEach(s=>{et(r,s.mutationKey)&&Object.assign(e,s.defaultOptions);}),e}defaultQueryOptions(r){if(r._defaulted)return r;let t={...i(this,_).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:true};return t.queryHash||(t.queryHash=mt(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===tt&&(t.enabled=false),t}defaultMutationOptions(r){return r?._defaulted?r:{...i(this,_).mutations,...r?.mutationKey&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:true}}clear(){i(this,f).clear(),i(this,K).clear();}},f=new WeakMap,K=new WeakMap,_=new WeakMap,ot=new WeakMap,ut=new WeakMap,L=new WeakMap,ct=new WeakMap,ht=new WeakMap,le);exports.DkanApiClient=dt;exports.DkanApiError=S;exports.DkanClient=Qt;exports.QueryClient=pe;return exports;})({});//# sourceMappingURL=index.global.min.js.map
//# sourceMappingURL=index.global.min.js.map