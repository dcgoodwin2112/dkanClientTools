var DkanClientTools=(function(exports){'use strict';/* @dkan-client-tools/core - Minified IIFE build for browsers and Drupal */
var Ht=r=>{throw TypeError(r)};var kt=(r,t,e)=>t.has(r)||Ht("Cannot "+e);var a=(r,t,e)=>(kt(r,t,"read from private field"),e?e.call(r):t.get(r)),h=(r,t,e)=>t.has(r)?Ht("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),l=(r,t,e,s)=>(kt(r,t,"write to private field"),t.set(r,e),e),b=(r,t,e)=>(kt(r,t,"access private method"),e);var pt=(r,t,e,s)=>({set _(i){l(r,t,i);},get _(){return a(r,t,s)}});var C=class extends Error{constructor(e,s,i,u,c){super(e);this.statusCode=s;this.response=i;this.timestamp=u;this.data=c;this.name="DkanApiError";}};var dt=class{constructor(t){this.baseUrl=t.baseUrl.replace(/\/$/,""),t.auth&&("token"in t.auth&&t.auth.token?this.auth={token:t.auth.token}:"username"in t.auth&&"password"in t.auth&&t.auth.username&&t.auth.password&&(this.auth={username:t.auth.username,password:t.auth.password})),this.defaultOptions={retry:t.defaultOptions?.retry??3,retryDelay:t.defaultOptions?.retryDelay??1e3,staleTime:t.defaultOptions?.staleTime??0,cacheTime:t.defaultOptions?.cacheTime??300*1e3};}getAuthHeader(){if(this.auth){if("token"in this.auth)return `Bearer ${this.auth.token}`;if("username"in this.auth&&"password"in this.auth)return `Basic ${btoa(`${this.auth.username}:${this.auth.password}`)}`}}async request(t,e={},s=0){let i=`${this.baseUrl}${t}`,u=this.getAuthHeader(),c={"Content-Type":"application/json",...e.headers};u&&(c.Authorization=u);try{let n=await fetch(i,{...e,headers:c});if(!n.ok){let d=await n.text(),p,f,D;try{p=JSON.parse(d),f=p.timestamp,D=p.data;}catch{}throw new C(p?.message||`HTTP ${n.status}: ${n.statusText}`,n.status,d,f,D)}return {data:await n.json(),status:n.status,statusText:n.statusText}}catch(n){if(s<this.defaultOptions.retry)return await new Promise(o=>setTimeout(o,this.defaultOptions.retryDelay*(s+1))),this.request(t,e,s+1);throw n instanceof C?n:new C(n instanceof Error?n.message:"Unknown error occurred")}}async getDataset(t,e){let s=e?.showReferenceIds?"?show-reference-ids":"";return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}${s}`)).data}appendArrayOrString(t,e,s){Array.isArray(s)?s.forEach(i=>t.append(e,i)):t.append(e,s);}serializeQueryOptions(t){let e=new URLSearchParams;for(let[s,i]of Object.entries(t))i!==void 0&&e.append(s,typeof i=="string"?i:JSON.stringify(i));return e.toString()}async searchDatasets(t={}){let e=new URLSearchParams;t.keyword&&e.append("keyword",t.keyword),t.theme&&e.append("theme",t.theme),t.fulltext&&e.append("fulltext",t.fulltext),t.sort&&this.appendArrayOrString(e,"sort",t.sort),t["sort-order"]&&this.appendArrayOrString(e,"sort-order",t["sort-order"]),t.page!==void 0&&e.append("page",t.page.toString()),t["page-size"]!==void 0&&e.append("page-size",t["page-size"].toString());let s=e.toString(),i=`/api/1/search${s?`?${s}`:""}`,c=(await this.request(i)).data,n=[];return c.results&&typeof c.results=="object"&&(n=Object.values(c.results)),{total:typeof c.total=="string"?parseInt(c.total,10):c.total,results:n,facets:c.facets}}async queryDatastore(t,e=0,s={},i="POST"){if(i==="GET"){let c=this.serializeQueryOptions(s),n=c?`/api/1/datastore/query/${t}/${e}?${c}`:`/api/1/datastore/query/${t}/${e}`;return (await this.request(n)).data}return (await this.request(`/api/1/datastore/query/${t}/${e}`,{method:"POST",body:JSON.stringify(s)})).data}async queryDatastoreMulti(t,e="POST"){if(e==="GET"){let i=this.serializeQueryOptions(t),u=i?`/api/1/datastore/query?${i}`:"/api/1/datastore/query";return (await this.request(u)).data}return (await this.request("/api/1/datastore/query",{method:"POST",body:JSON.stringify(t)})).data}async getDatastoreSchema(t,e=0){return (await this.request(`/api/1/datastore/query/${t}/${e}?schema=true`)).data}async listDataDictionaries(){let t=await this.request("/api/1/metastore/schemas/data-dictionary/items");return t.data&&Array.isArray(t.data)?t.data:t.data&&typeof t.data=="object"?Object.values(t.data):[]}async getDataDictionary(t){return (await this.request(`/api/1/metastore/schemas/data-dictionary/items/${t}`)).data}async getDataDictionaryFromUrl(t){try{let e=await fetch(t);if(!e.ok)throw new C(`HTTP ${e.status}: ${e.statusText}`,e.status);return await e.json()}catch(e){throw e instanceof C?e:new C(e instanceof Error?e.message:"Failed to fetch data dictionary")}}async listAllDatasets(){let t=await this.request("/api/1/metastore/schemas/dataset/items");return t.data&&Array.isArray(t.data)?t.data:t.data&&typeof t.data=="object"?Object.values(t.data):[]}async listSchemas(){let t=await this.request("/api/1/metastore/schemas");return Array.isArray(t.data)?t.data:typeof t.data=="object"?Object.keys(t.data):[]}async getSchema(t){return (await this.request(`/api/1/metastore/schemas/${t}`)).data}async getSchemaItems(t,e){let s=e?.showReferenceIds?"?show-reference-ids":"",i=await this.request(`/api/1/metastore/schemas/${t}/items${s}`);return i.data&&Array.isArray(i.data)?i.data:i.data&&typeof i.data=="object"?Object.values(i.data):[]}async getDatasetFacets(){let t=await this.request("/api/1/search/facets"),e={theme:[],keyword:[],publisher:[]};return Array.isArray(t.data)&&t.data.forEach(s=>{s.type==="theme"&&Array.isArray(s.values)?e.theme=s.values.map(i=>typeof i=="string"?i:i.value||""):s.type==="keyword"&&Array.isArray(s.values)?e.keyword=s.values.map(i=>typeof i=="string"?i:i.value||""):s.type==="publisher"&&Array.isArray(s.values)&&(e.publisher=s.values.map(i=>typeof i=="string"?i:i.value||""));}),e}getBaseUrl(){return this.baseUrl}getDefaultOptions(){return {...this.defaultOptions}}async listHarvestPlans(){return (await this.request("/api/1/harvest/plans")).data}async registerHarvestPlan(t){return (await this.request("/api/1/harvest/plans",{method:"POST",body:JSON.stringify(t)})).data}async getHarvestPlan(t){return (await this.request(`/api/1/harvest/plans/${t}`)).data}async listHarvestRuns(t){return (await this.request(`/api/1/harvest/runs?plan=${t}`)).data}async getHarvestRun(t,e){return (await this.request(`/api/1/harvest/runs/${t}?plan=${e}`)).data}async runHarvest(t){return (await this.request("/api/1/harvest/runs",{method:"POST",body:JSON.stringify(t)})).data}async createDataset(t){return (await this.request("/api/1/metastore/schemas/dataset/items",{method:"POST",body:JSON.stringify(t)})).data}async updateDataset(t,e){return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}`,{method:"PUT",body:JSON.stringify(e)})).data}async patchDataset(t,e){return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}`,{method:"PATCH",body:JSON.stringify(e)})).data}async deleteDataset(t){return (await this.request(`/api/1/metastore/schemas/dataset/items/${t}`,{method:"DELETE"})).data}async listDatastoreImports(){return (await this.request("/api/1/datastore/imports")).data}async triggerDatastoreImport(t){return (await this.request("/api/1/datastore/imports",{method:"POST",body:JSON.stringify(t)})).data}async deleteDatastore(t){return (await this.request(`/api/1/datastore/imports/${t}`,{method:"DELETE"})).data}async getDatastoreStatistics(t){return (await this.request(`/api/1/datastore/imports/${t}`)).data}async getRevisions(t,e){return (await this.request(`/api/1/metastore/schemas/${t}/items/${e}/revisions`)).data}async getRevision(t,e,s){return (await this.request(`/api/1/metastore/schemas/${t}/items/${e}/revisions/${s}`)).data}async createRevision(t,e,s){return (await this.request(`/api/1/metastore/schemas/${t}/items/${e}/revisions`,{method:"POST",body:JSON.stringify(s)})).data}async changeDatasetState(t,e,s){return this.createRevision("dataset",t,{state:e,message:s})}async downloadQuery(t,e,s={}){let i=s.format||"csv",u={...s};delete u.format;let c=new URLSearchParams({format:i});if(Object.keys(u).length>0)for(let[f,D]of Object.entries(u))D!==void 0&&c.append(f,typeof D=="string"?D:JSON.stringify(D));let n=`${this.baseUrl}/api/1/datastore/query/${t}/${e}/download?${c.toString()}`,o=this.getAuthHeader(),d={};o&&(d.Authorization=o);let p=await fetch(n,{method:"GET",headers:d});if(!p.ok)throw new C(`HTTP ${p.status}: ${p.statusText}`,p.status);return await p.blob()}async downloadQueryByDistribution(t,e={}){let s=e.format||"csv",i={...e};delete i.format;let u=new URLSearchParams({format:s});if(Object.keys(i).length>0)for(let[p,f]of Object.entries(i))f!==void 0&&u.append(p,typeof f=="string"?f:JSON.stringify(f));let c=`${this.baseUrl}/api/1/datastore/query/${t}/download?${u.toString()}`,n=this.getAuthHeader(),o={};n&&(o.Authorization=n);let d=await fetch(c,{method:"GET",headers:o});if(!d.ok)throw new C(`HTTP ${d.status}: ${d.statusText}`,d.status);return await d.blob()}async querySql(t){if((t.method||"GET")==="GET"){let s=new URLSearchParams({query:t.query});return t.show_db_columns&&s.append("show_db_columns","true"),(await this.request(`/api/1/datastore/sql?${s.toString()}`,{method:"GET"})).data}else return (await this.request("/api/1/datastore/sql",{method:"POST",body:JSON.stringify({query:t.query,show_db_columns:t.show_db_columns})})).data}async createDataDictionary(t){return (await this.request("/api/1/metastore/schemas/data-dictionary/items",{method:"POST",body:JSON.stringify(t)})).data}async updateDataDictionary(t,e){return (await this.request(`/api/1/metastore/schemas/data-dictionary/items/${t}`,{method:"PUT",body:JSON.stringify(e)})).data}async deleteDataDictionary(t){return (await this.request(`/api/1/metastore/schemas/data-dictionary/items/${t}`,{method:"DELETE"})).data}getOpenApiDocsUrl(){return `${this.baseUrl}/api/1`}};var Qt=class{constructor(t){this.mountCount=0;if(!t.queryClient)throw new Error("DkanClient requires a QueryClient. Create one using your framework adapter (e.g., @tanstack/vue-query) and pass it to DkanClient.");this.apiClient=new dt(t),this.queryClient=t.queryClient;}getApiClient(){return this.apiClient}getQueryClient(){return this.queryClient}mount(){this.mountCount++,this.mountCount===1&&this.queryClient.mount();}unmount(){this.mountCount--,this.mountCount===0&&this.queryClient.unmount();}isMounted(){return this.mountCount>0}async fetchDataset(t){return this.apiClient.getDataset(t)}async searchDatasets(t){return this.apiClient.searchDatasets(t)}async queryDatastore(t,e,s){return this.apiClient.queryDatastore(t,e,s)}async getDatastoreSchema(t,e){return this.apiClient.getDatastoreSchema(t,e)}async listDataDictionaries(){return this.apiClient.listDataDictionaries()}async getDataDictionary(t){return this.apiClient.getDataDictionary(t)}async getDataDictionaryFromUrl(t){return this.apiClient.getDataDictionaryFromUrl(t)}async listAllDatasets(){return this.apiClient.listAllDatasets()}async listSchemas(){return this.apiClient.listSchemas()}async getSchemaItems(t){return this.apiClient.getSchemaItems(t)}async getDatasetFacets(){return this.apiClient.getDatasetFacets()}async getSchema(t){return this.apiClient.getSchema(t)}async getDatastoreStatistics(t){return this.apiClient.getDatastoreStatistics(t)}async queryDatastoreMulti(t,e="POST"){return this.apiClient.queryDatastoreMulti(t,e)}async prefetchQuery(t,e,s){await this.queryClient.prefetchQuery({queryKey:t,queryFn:e,staleTime:s?.staleTime});}getQueryData(t){return this.queryClient.getQueryData(t)}setQueryData(t,e){this.queryClient.setQueryData(t,e);}async invalidateQueries(t){await this.queryClient.invalidateQueries({queryKey:t});}clear(){this.queryClient.clear();}removeQueries(t){this.queryClient.removeQueries({queryKey:t});}getQueryCache(){return this.queryClient.getQueryCache()}async listHarvestPlans(){return this.apiClient.listHarvestPlans()}async registerHarvestPlan(t){return this.apiClient.registerHarvestPlan(t)}async getHarvestPlan(t){return this.apiClient.getHarvestPlan(t)}async listHarvestRuns(t){return this.apiClient.listHarvestRuns(t)}async getHarvestRun(t,e){return this.apiClient.getHarvestRun(t,e)}async runHarvest(t){return this.apiClient.runHarvest(t)}async createDataset(t){return this.apiClient.createDataset(t)}async updateDataset(t,e){return this.apiClient.updateDataset(t,e)}async patchDataset(t,e){return this.apiClient.patchDataset(t,e)}async deleteDataset(t){return this.apiClient.deleteDataset(t)}async listDatastoreImports(){return this.apiClient.listDatastoreImports()}async triggerDatastoreImport(t){return this.apiClient.triggerDatastoreImport(t)}async deleteDatastore(t){return this.apiClient.deleteDatastore(t)}async getRevisions(t,e){return this.apiClient.getRevisions(t,e)}async getRevision(t,e,s){return this.apiClient.getRevision(t,e,s)}async createRevision(t,e,s){return this.apiClient.createRevision(t,e,s)}async changeDatasetState(t,e,s){return this.apiClient.changeDatasetState(t,e,s)}async downloadQuery(t,e,s){return this.apiClient.downloadQuery(t,e,s)}async downloadQueryByDistribution(t,e){return this.apiClient.downloadQueryByDistribution(t,e)}async querySql(t){return this.apiClient.querySql(t)}async createDataDictionary(t){return this.apiClient.createDataDictionary(t)}async updateDataDictionary(t,e){return this.apiClient.updateDataDictionary(t,e)}async deleteDataDictionary(t){return this.apiClient.deleteDataDictionary(t)}getOpenApiDocsUrl(){return this.apiClient.getOpenApiDocsUrl()}};var H=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this);}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe();}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}};var de={setTimeout:(r,t)=>setTimeout(r,t),clearTimeout:r=>clearTimeout(r),setInterval:(r,t)=>setInterval(r,t),clearInterval:r=>clearInterval(r)},T,W,$t,fe=($t=class{constructor(){h(this,T,de);h(this,W,false);}setTimeoutProvider(r){process.env.NODE_ENV!=="production"&&a(this,W)&&r!==a(this,T)&&console.error("[timeoutManager]: Switching provider after calls to previous provider might result in unexpected behavior.",{previous:a(this,T),provider:r}),l(this,T,r),process.env.NODE_ENV!=="production"&&l(this,W,false);}setTimeout(r,t){return process.env.NODE_ENV!=="production"&&l(this,W,true),a(this,T).setTimeout(r,t)}clearTimeout(r){a(this,T).clearTimeout(r);}setInterval(r,t){return process.env.NODE_ENV!=="production"&&l(this,W,true),a(this,T).setInterval(r,t)}clearInterval(r){a(this,T).clearInterval(r);}},T=new WeakMap,W=new WeakMap,$t),ft=new fe;function jt(r){setTimeout(r,0);}var $=typeof window>"u"||"Deno"in globalThis;function O(){}function Kt(r,t){return typeof r=="function"?r(t):r}function Lt(r){return typeof r=="number"&&r>=0&&r!==1/0}function _t(r,t){return Math.max(r+(t||0)-Date.now(),0)}function yt(r,t){return typeof r=="function"?r(t):r}function Jt(r,t){return typeof r=="function"?r(t):r}function At(r,t){let{type:e="all",exact:s,fetchStatus:i,predicate:u,queryKey:c,stale:n}=r;if(c){if(s){if(t.queryHash!==mt(c,t.options))return  false}else if(!et(t.queryKey,c))return  false}if(e!=="all"){let o=t.isActive();if(e==="active"&&!o||e==="inactive"&&o)return  false}return !(typeof n=="boolean"&&t.isStale()!==n||i&&i!==t.state.fetchStatus||u&&!u(t))}function Ft(r,t){let{exact:e,status:s,predicate:i,mutationKey:u}=r;if(u){if(!t.options.mutationKey)return  false;if(e){if(Y(t.options.mutationKey)!==Y(u))return  false}else if(!et(t.options.mutationKey,u))return  false}return !(s&&t.state.status!==s||i&&!i(t))}function mt(r,t){return (t?.queryKeyHashFn||Y)(r)}function Y(r){return JSON.stringify(r,(t,e)=>xt(e)?Object.keys(e).sort().reduce((s,i)=>(s[i]=e[i],s),{}):e)}function et(r,t){return r===t?true:typeof r!=typeof t?false:r&&t&&typeof r=="object"&&typeof t=="object"?Object.keys(t).every(e=>et(r[e],t[e])):false}var ye=Object.prototype.hasOwnProperty;function Tt(r,t){if(r===t)return r;let e=Ut(r)&&Ut(t);if(!e&&!(xt(r)&&xt(t)))return t;let i=(e?r:Object.keys(r)).length,u=e?t:Object.keys(t),c=u.length,n=e?new Array(c):{},o=0;for(let d=0;d<c;d++){let p=e?d:u[d],f=r[p],D=t[p];if(f===D){n[p]=f,(e?d<i:ye.call(r,p))&&o++;continue}if(f===null||D===null||typeof f!="object"||typeof D!="object"){n[p]=D;continue}let I=Tt(f,D);n[p]=I,I===f&&o++;}return i===c&&o===i?r:n}function Ut(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function xt(r){if(!Nt(r))return  false;let t=r.constructor;if(t===void 0)return  true;let e=t.prototype;return !(!Nt(e)||!e.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function Nt(r){return Object.prototype.toString.call(r)==="[object Object]"}function Wt(r){return new Promise(t=>{ft.setTimeout(t,r);})}function Gt(r,t,e){if(typeof e.structuralSharing=="function")return e.structuralSharing(r,t);if(e.structuralSharing!==false){if(process.env.NODE_ENV!=="production")try{return Tt(r,t)}catch(s){throw console.error(`Structural sharing requires data to be JSON serializable. To fix this, turn off structuralSharing or return JSON-serializable data from your queryFn. [${e.queryHash}]: ${s}`),s}return Tt(r,t)}return t}function Bt(r,t,e=0){let s=[...r,t];return e&&s.length>e?s.slice(1):s}function zt(r,t,e=0){let s=[t,...r];return e&&s.length>e?s.slice(0,-1):s}var tt=Symbol();function St(r,t){return process.env.NODE_ENV!=="production"&&r.queryFn===tt&&console.error(`Attempted to invoke queryFn when set to skipToken. This is likely a configuration error. Query hash: '${r.queryHash}'`),!r.queryFn&&t?.initialPromise?()=>t.initialPromise:!r.queryFn||r.queryFn===tt?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var G,j,rt,Vt,me=(Vt=class extends H{constructor(){super();h(this,G);h(this,j);h(this,rt);l(this,rt,t=>{if(!$&&window.addEventListener){let e=()=>t();return window.addEventListener("visibilitychange",e,false),()=>{window.removeEventListener("visibilitychange",e);}}});}onSubscribe(){a(this,j)||this.setEventListener(a(this,rt));}onUnsubscribe(){var t;this.hasListeners()||((t=a(this,j))==null||t.call(this),l(this,j,void 0));}setEventListener(t){var e;l(this,rt,t),(e=a(this,j))==null||e.call(this),l(this,j,t(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus();}));}setFocused(t){a(this,G)!==t&&(l(this,G,t),this.onFocus());}onFocus(){let t=this.isFocused();this.listeners.forEach(e=>{e(t);});}isFocused(){return typeof a(this,G)=="boolean"?a(this,G):globalThis.document?.visibilityState!=="hidden"}},G=new WeakMap,j=new WeakMap,rt=new WeakMap,Vt),Ot=new me;function Zt(){let r,t,e=new Promise((i,u)=>{r=i,t=u;});e.status="pending",e.catch(()=>{});function s(i){Object.assign(e,i),delete e.resolve,delete e.reject;}return e.resolve=i=>{s({status:"fulfilled",value:i}),r(i);},e.reject=i=>{s({status:"rejected",reason:i}),t(i);},e}var ge=jt;function De(){let r=[],t=0,e=n=>{n();},s=n=>{n();},i=ge,u=n=>{t?r.push(n):i(()=>{e(n);});},c=()=>{let n=r;r=[],n.length&&i(()=>{s(()=>{n.forEach(o=>{e(o);});});});};return {batch:n=>{let o;t++;try{o=n();}finally{t--,t||c();}return o},batchCalls:n=>(...o)=>{u(()=>{n(...o);});},schedule:u,setNotifyFunction:n=>{e=n;},setBatchNotifyFunction:n=>{s=n;},setScheduler:n=>{i=n;}}}var g=De();var st,U,at,Xt,ve=(Xt=class extends H{constructor(){super();h(this,st,true);h(this,U);h(this,at);l(this,at,t=>{if(!$&&window.addEventListener){let e=()=>t(true),s=()=>t(false);return window.addEventListener("online",e,false),window.addEventListener("offline",s,false),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s);}}});}onSubscribe(){a(this,U)||this.setEventListener(a(this,at));}onUnsubscribe(){var t;this.hasListeners()||((t=a(this,U))==null||t.call(this),l(this,U,void 0));}setEventListener(t){var e;l(this,at,t),(e=a(this,U))==null||e.call(this),l(this,U,t(this.setOnline.bind(this)));}setOnline(t){a(this,st)!==t&&(l(this,st,t),this.listeners.forEach(s=>{s(t);}));}isOnline(){return a(this,st)}},st=new WeakMap,U=new WeakMap,at=new WeakMap,Xt),it=new ve;function be(r){return Math.min(1e3*2**r,3e4)}function Mt(r){return (r??"online")==="online"?it.isOnline():true}var Pt=class extends Error{constructor(r){super("CancelledError"),this.revert=r?.revert,this.silent=r?.silent;}};function Ct(r){let t=false,e=0,s,i=Zt(),u=()=>i.status!=="pending",c=m=>{if(!u()){let P=new Pt(m);D(P),r.onCancel?.(P);}},n=()=>{t=true;},o=()=>{t=false;},d=()=>Ot.isFocused()&&(r.networkMode==="always"||it.isOnline())&&r.canRun(),p=()=>Mt(r.networkMode)&&r.canRun(),f=m=>{u()||(s?.(),i.resolve(m));},D=m=>{u()||(s?.(),i.reject(m));},I=()=>new Promise(m=>{s=P=>{(u()||d())&&m(P);},r.onPause?.();}).then(()=>{s=void 0,u()||r.onContinue?.();}),w=()=>{if(u())return;let m,P=e===0?r.initialPromise:void 0;try{m=P??r.fn();}catch(Q){m=Promise.reject(Q);}Promise.resolve(m).then(f).catch(Q=>{if(u())return;let J=r.retry??($?0:3),ht=r.retryDelay??be,bt=typeof ht=="function"?ht(e,Q):ht,wt=J===true||typeof J=="number"&&e<J||typeof J=="function"&&J(e,Q);if(t||!wt){D(Q);return}e++,r.onFail?.(e,Q),Wt(bt).then(()=>d()?void 0:I()).then(()=>{t?D(Q):w();});});};return {promise:i,status:()=>i.status,cancel:c,continue:()=>(s?.(),i),cancelRetry:n,continueRetry:o,canStart:p,start:()=>(p()?w():I().then(w),i)}}var B,Yt,qt=(Yt=class{constructor(){h(this,B);}destroy(){this.clearGcTimeout();}scheduleGc(){this.clearGcTimeout(),Lt(this.gcTime)&&l(this,B,ft.setTimeout(()=>{this.optionalRemove();},this.gcTime));}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??($?1/0:300*1e3));}clearGcTimeout(){a(this,B)&&(ft.clearTimeout(a(this,B)),l(this,B,void 0));}},B=new WeakMap,Yt);var z,nt,q,V,v,gt,Z,R,M,re,se=(re=class extends qt{constructor(t){super();h(this,R);h(this,z);h(this,nt);h(this,q);h(this,V);h(this,v);h(this,gt);h(this,Z);l(this,Z,false),l(this,gt,t.defaultOptions),this.setOptions(t.options),this.observers=[],l(this,V,t.client),l(this,q,a(this,V).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,l(this,z,ee(this.options)),this.state=t.state??a(this,z),this.scheduleGc();}get meta(){return this.options.meta}get promise(){return a(this,v)?.promise}setOptions(t){if(this.options={...a(this,gt),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){let e=ee(this.options);e.data!==void 0&&(this.setState(te(e.data,e.dataUpdatedAt)),l(this,z,e));}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&a(this,q).remove(this);}setData(t,e){let s=Gt(this.state.data,t,this.options);return b(this,R,M).call(this,{data:s,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),s}setState(t,e){b(this,R,M).call(this,{type:"setState",state:t,setStateOptions:e});}cancel(t){let e=a(this,v)?.promise;return a(this,v)?.cancel(t),e?e.then(O).catch(O):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:true});}reset(){this.destroy(),this.setState(a(this,z));}isActive(){return this.observers.some(t=>Jt(t.options.enabled,this)!==false)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===tt||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>yt(t.options.staleTime,this)==="static"):false}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?true:t==="static"?false:this.state.isInvalidated?true:!_t(this.state.dataUpdatedAt,t)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:false}),a(this,v)?.continue();}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:false}),a(this,v)?.continue();}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),a(this,q).notify({type:"observerAdded",query:this,observer:t}));}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(a(this,v)&&(a(this,Z)?a(this,v).cancel({revert:true}):a(this,v).cancelRetry()),this.scheduleGc()),a(this,q).notify({type:"observerRemoved",query:this,observer:t}));}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||b(this,R,M).call(this,{type:"invalidate"});}async fetch(t,e){if(this.state.fetchStatus!=="idle"&&a(this,v)?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:true});else if(a(this,v))return a(this,v).continueRetry(),a(this,v).promise}if(t&&this.setOptions(t),!this.options.queryFn){let o=this.observers.find(d=>d.options.queryFn);o&&this.setOptions(o.options);}process.env.NODE_ENV!=="production"&&(Array.isArray(this.options.queryKey)||console.error("As of v4, queryKey needs to be an Array. If you are using a string like 'repoData', please change it to an Array, e.g. ['repoData']"));let s=new AbortController,i=o=>{Object.defineProperty(o,"signal",{enumerable:true,get:()=>(l(this,Z,true),s.signal)});},u=()=>{let o=St(this.options,e),p=(()=>{let f={client:a(this,V),queryKey:this.queryKey,meta:this.meta};return i(f),f})();return l(this,Z,false),this.options.persister?this.options.persister(o,p,this):o(p)},n=(()=>{let o={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:a(this,V),state:this.state,fetchFn:u};return i(o),o})();this.options.behavior?.onFetch(n,this),l(this,nt,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==n.fetchOptions?.meta)&&b(this,R,M).call(this,{type:"fetch",meta:n.fetchOptions?.meta}),l(this,v,Ct({initialPromise:e?.initialPromise,fn:n.fetchFn,onCancel:o=>{o instanceof Pt&&o.revert&&this.setState({...a(this,nt),fetchStatus:"idle"}),s.abort();},onFail:(o,d)=>{b(this,R,M).call(this,{type:"failed",failureCount:o,error:d});},onPause:()=>{b(this,R,M).call(this,{type:"pause"});},onContinue:()=>{b(this,R,M).call(this,{type:"continue"});},retry:n.options.retry,retryDelay:n.options.retryDelay,networkMode:n.options.networkMode,canRun:()=>true}));try{let o=await a(this,v).start();if(o===void 0)throw process.env.NODE_ENV!=="production"&&console.error(`Query data cannot be undefined. Please make sure to return a value other than undefined from your query function. Affected query key: ${this.queryHash}`),new Error(`${this.queryHash} data is undefined`);return this.setData(o),a(this,q).config.onSuccess?.(o,this),a(this,q).config.onSettled?.(o,this.state.error,this),o}catch(o){if(o instanceof Pt){if(o.silent)return a(this,v).promise;if(o.revert){if(this.state.data===void 0)throw o;return this.state.data}}throw b(this,R,M).call(this,{type:"error",error:o}),a(this,q).config.onError?.(o,this),a(this,q).config.onSettled?.(this.state.data,o,this),o}finally{this.scheduleGc();}}},z=new WeakMap,nt=new WeakMap,q=new WeakMap,V=new WeakMap,v=new WeakMap,gt=new WeakMap,Z=new WeakMap,R=new WeakSet,M=function(t){let e=s=>{switch(t.type){case "failed":return {...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case "pause":return {...s,fetchStatus:"paused"};case "continue":return {...s,fetchStatus:"fetching"};case "fetch":return {...s,...we(s.data,this.options),fetchMeta:t.meta??null};case "success":let i={...s,...te(t.data,t.dataUpdatedAt),dataUpdateCount:s.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return l(this,nt,t.manual?i:void 0),i;case "error":let u=t.error;return {...s,error:u,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:u,fetchStatus:"idle",status:"error"};case "invalidate":return {...s,isInvalidated:true};case "setState":return {...s,...t.state}}};this.state=e(this.state),g.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate();}),a(this,q).notify({query:this,type:"updated",action:t});});},re);function we(r,t){return {fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Mt(t.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function te(r,t){return {data:r,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:false,status:"success"}}function ee(r){let t=typeof r.initialData=="function"?r.initialData():r.initialData,e=t!==void 0,s=e?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return {data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:false,status:e?"success":"pending",fetchStatus:"idle"}}function Et(r){return {onFetch:(t,e)=>{let s=t.options,i=t.fetchOptions?.meta?.fetchMore?.direction,u=t.state.data?.pages||[],c=t.state.data?.pageParams||[],n={pages:[],pageParams:[]},o=0,d=async()=>{let p=false,f=w=>{Object.defineProperty(w,"signal",{enumerable:true,get:()=>(t.signal.aborted?p=true:t.signal.addEventListener("abort",()=>{p=true;}),t.signal)});},D=St(t.options,t.fetchOptions),I=async(w,m,P)=>{if(p)return Promise.reject();if(m==null&&w.pages.length)return Promise.resolve(w);let J=(()=>{let It={client:t.client,queryKey:t.queryKey,pageParam:m,direction:P?"backward":"forward",meta:t.options.meta};return f(It),It})(),ht=await D(J),{maxPages:bt}=t.options,wt=P?zt:Bt;return {pages:wt(w.pages,ht,bt),pageParams:wt(w.pageParams,m,bt)}};if(i&&u.length){let w=i==="backward",m=w?Se:ae,P={pages:u,pageParams:c},Q=m(s,P);n=await I(P,Q,w);}else {let w=r??u.length;do{let m=o===0?c[0]??s.initialPageParam:ae(s,n);if(o>0&&m==null)break;n=await I(n,m),o++;}while(o<w)}return n};t.options.persister?t.fetchFn=()=>t.options.persister?.(d,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},e):t.fetchFn=d;}}}function ae(r,{pages:t,pageParams:e}){let s=t.length-1;return t.length>0?r.getNextPageParam(t[s],t,e[s],e):void 0}function Se(r,{pages:t,pageParams:e}){return t.length>0?r.getPreviousPageParam?.(t[0],t,e[0],e):void 0}var Dt,x,S,X,A,N,ie,ne=(ie=class extends qt{constructor(t){super();h(this,A);h(this,Dt);h(this,x);h(this,S);h(this,X);l(this,Dt,t.client),this.mutationId=t.mutationId,l(this,S,t.mutationCache),l(this,x,[]),this.state=t.state||Oe(),this.setOptions(t.options),this.scheduleGc();}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime);}get meta(){return this.options.meta}addObserver(t){a(this,x).includes(t)||(a(this,x).push(t),this.clearGcTimeout(),a(this,S).notify({type:"observerAdded",mutation:this,observer:t}));}removeObserver(t){l(this,x,a(this,x).filter(e=>e!==t)),this.scheduleGc(),a(this,S).notify({type:"observerRemoved",mutation:this,observer:t});}optionalRemove(){a(this,x).length||(this.state.status==="pending"?this.scheduleGc():a(this,S).remove(this));}continue(){return a(this,X)?.continue()??this.execute(this.state.variables)}async execute(t){let e=()=>{b(this,A,N).call(this,{type:"continue"});},s={client:a(this,Dt),meta:this.options.meta,mutationKey:this.options.mutationKey};l(this,X,Ct({fn:()=>this.options.mutationFn?this.options.mutationFn(t,s):Promise.reject(new Error("No mutationFn found")),onFail:(c,n)=>{b(this,A,N).call(this,{type:"failed",failureCount:c,error:n});},onPause:()=>{b(this,A,N).call(this,{type:"pause"});},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>a(this,S).canRun(this)}));let i=this.state.status==="pending",u=!a(this,X).canStart();try{if(i)e();else {b(this,A,N).call(this,{type:"pending",variables:t,isPaused:u}),await a(this,S).config.onMutate?.(t,this,s);let n=await this.options.onMutate?.(t,s);n!==this.state.context&&b(this,A,N).call(this,{type:"pending",context:n,variables:t,isPaused:u});}let c=await a(this,X).start();return await a(this,S).config.onSuccess?.(c,t,this.state.context,this,s),await this.options.onSuccess?.(c,t,this.state.context,s),await a(this,S).config.onSettled?.(c,null,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(c,null,t,this.state.context,s),b(this,A,N).call(this,{type:"success",data:c}),c}catch(c){try{throw await a(this,S).config.onError?.(c,t,this.state.context,this,s),await this.options.onError?.(c,t,this.state.context,s),await a(this,S).config.onSettled?.(void 0,c,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(void 0,c,t,this.state.context,s),c}finally{b(this,A,N).call(this,{type:"error",error:c});}}finally{a(this,S).runNext(this);}}},Dt=new WeakMap,x=new WeakMap,S=new WeakMap,X=new WeakMap,A=new WeakSet,N=function(t){let e=s=>{switch(t.type){case "failed":return {...s,failureCount:t.failureCount,failureReason:t.error};case "pause":return {...s,isPaused:true};case "continue":return {...s,isPaused:false};case "pending":return {...s,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case "success":return {...s,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:false};case "error":return {...s,data:void 0,error:t.error,failureCount:s.failureCount+1,failureReason:t.error,isPaused:false,status:"error"}}};this.state=e(this.state),g.batch(()=>{a(this,x).forEach(s=>{s.onMutationUpdate(t);}),a(this,S).notify({mutation:this,type:"updated",action:t});});},ie);function Oe(){return {context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:false,status:"idle",variables:void 0,submittedAt:0}}var E,k,vt,oe,ue=(oe=class extends H{constructor(t={}){super();h(this,E);h(this,k);h(this,vt);this.config=t,l(this,E,new Set),l(this,k,new Map),l(this,vt,0);}build(t,e,s){let i=new ne({client:t,mutationCache:this,mutationId:++pt(this,vt)._,options:t.defaultMutationOptions(e),state:s});return this.add(i),i}add(t){a(this,E).add(t);let e=Rt(t);if(typeof e=="string"){let s=a(this,k).get(e);s?s.push(t):a(this,k).set(e,[t]);}this.notify({type:"added",mutation:t});}remove(t){if(a(this,E).delete(t)){let e=Rt(t);if(typeof e=="string"){let s=a(this,k).get(e);if(s)if(s.length>1){let i=s.indexOf(t);i!==-1&&s.splice(i,1);}else s[0]===t&&a(this,k).delete(e);}}this.notify({type:"removed",mutation:t});}canRun(t){let e=Rt(t);if(typeof e=="string"){let i=a(this,k).get(e)?.find(u=>u.state.status==="pending");return !i||i===t}else return  true}runNext(t){let e=Rt(t);return typeof e=="string"?a(this,k).get(e)?.find(i=>i!==t&&i.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){g.batch(()=>{a(this,E).forEach(t=>{this.notify({type:"removed",mutation:t});}),a(this,E).clear(),a(this,k).clear();});}getAll(){return Array.from(a(this,E))}find(t){let e={exact:true,...t};return this.getAll().find(s=>Ft(e,s))}findAll(t={}){return this.getAll().filter(e=>Ft(t,e))}notify(t){g.batch(()=>{this.listeners.forEach(e=>{e(t);});});}resumePausedMutations(){let t=this.getAll().filter(e=>e.state.isPaused);return g.batch(()=>Promise.all(t.map(e=>e.continue().catch(O))))}},E=new WeakMap,k=new WeakMap,vt=new WeakMap,oe);function Rt(r){return r.options.scope?.id}var F,ce,le=(ce=class extends H{constructor(t={}){super();h(this,F);this.config=t,l(this,F,new Map);}build(t,e,s){let i=e.queryKey,u=e.queryHash??mt(i,e),c=this.get(u);return c||(c=new se({client:t,queryKey:i,queryHash:u,options:t.defaultQueryOptions(e),state:s,defaultOptions:t.getQueryDefaults(i)}),this.add(c)),c}add(t){a(this,F).has(t.queryHash)||(a(this,F).set(t.queryHash,t),this.notify({type:"added",query:t}));}remove(t){let e=a(this,F).get(t.queryHash);e&&(t.destroy(),e===t&&a(this,F).delete(t.queryHash),this.notify({type:"removed",query:t}));}clear(){g.batch(()=>{this.getAll().forEach(t=>{this.remove(t);});});}get(t){return a(this,F).get(t)}getAll(){return [...a(this,F).values()]}find(t){let e={exact:true,...t};return this.getAll().find(s=>At(e,s))}findAll(t={}){let e=this.getAll();return Object.keys(t).length>0?e.filter(s=>At(t,s)):e}notify(t){g.batch(()=>{this.listeners.forEach(e=>{e(t);});});}onFocus(){g.batch(()=>{this.getAll().forEach(t=>{t.onFocus();});});}onOnline(){g.batch(()=>{this.getAll().forEach(t=>{t.onOnline();});});}},F=new WeakMap,ce);var y,K,L,ot,ut,_,ct,lt,he,pe=(he=class{constructor(r={}){h(this,y);h(this,K);h(this,L);h(this,ot);h(this,ut);h(this,_);h(this,ct);h(this,lt);l(this,y,r.queryCache||new le),l(this,K,r.mutationCache||new ue),l(this,L,r.defaultOptions||{}),l(this,ot,new Map),l(this,ut,new Map),l(this,_,0);}mount(){pt(this,_)._++,a(this,_)===1&&(l(this,ct,Ot.subscribe(async r=>{r&&(await this.resumePausedMutations(),a(this,y).onFocus());})),l(this,lt,it.subscribe(async r=>{r&&(await this.resumePausedMutations(),a(this,y).onOnline());})));}unmount(){var r,t;pt(this,_)._--,a(this,_)===0&&((r=a(this,ct))==null||r.call(this),l(this,ct,void 0),(t=a(this,lt))==null||t.call(this),l(this,lt,void 0));}isFetching(r){return a(this,y).findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return a(this,K).findAll({...r,status:"pending"}).length}getQueryData(r){let t=this.defaultQueryOptions({queryKey:r});return a(this,y).get(t.queryHash)?.state.data}ensureQueryData(r){let t=this.defaultQueryOptions(r),e=a(this,y).build(this,t),s=e.state.data;return s===void 0?this.fetchQuery(r):(r.revalidateIfStale&&e.isStaleByTime(yt(t.staleTime,e))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(r){return a(this,y).findAll(r).map(({queryKey:t,state:e})=>{let s=e.data;return [t,s]})}setQueryData(r,t,e){let s=this.defaultQueryOptions({queryKey:r}),u=a(this,y).get(s.queryHash)?.state.data,c=Kt(t,u);if(c!==void 0)return a(this,y).build(this,s).setData(c,{...e,manual:true})}setQueriesData(r,t,e){return g.batch(()=>a(this,y).findAll(r).map(({queryKey:s})=>[s,this.setQueryData(s,t,e)]))}getQueryState(r){let t=this.defaultQueryOptions({queryKey:r});return a(this,y).get(t.queryHash)?.state}removeQueries(r){let t=a(this,y);g.batch(()=>{t.findAll(r).forEach(e=>{t.remove(e);});});}resetQueries(r,t){let e=a(this,y);return g.batch(()=>(e.findAll(r).forEach(s=>{s.reset();}),this.refetchQueries({type:"active",...r},t)))}cancelQueries(r,t={}){let e={revert:true,...t},s=g.batch(()=>a(this,y).findAll(r).map(i=>i.cancel(e)));return Promise.all(s).then(O).catch(O)}invalidateQueries(r,t={}){return g.batch(()=>(a(this,y).findAll(r).forEach(e=>{e.invalidate();}),r?.refetchType==="none"?Promise.resolve():this.refetchQueries({...r,type:r?.refetchType??r?.type??"active"},t)))}refetchQueries(r,t={}){let e={...t,cancelRefetch:t.cancelRefetch??true},s=g.batch(()=>a(this,y).findAll(r).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let u=i.fetch(void 0,e);return e.throwOnError||(u=u.catch(O)),i.state.fetchStatus==="paused"?Promise.resolve():u}));return Promise.all(s).then(O)}fetchQuery(r){let t=this.defaultQueryOptions(r);t.retry===void 0&&(t.retry=false);let e=a(this,y).build(this,t);return e.isStaleByTime(yt(t.staleTime,e))?e.fetch(t):Promise.resolve(e.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(O).catch(O)}fetchInfiniteQuery(r){return r.behavior=Et(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(O).catch(O)}ensureInfiniteQueryData(r){return r.behavior=Et(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return it.isOnline()?a(this,K).resumePausedMutations():Promise.resolve()}getQueryCache(){return a(this,y)}getMutationCache(){return a(this,K)}getDefaultOptions(){return a(this,L)}setDefaultOptions(r){l(this,L,r);}setQueryDefaults(r,t){a(this,ot).set(Y(r),{queryKey:r,defaultOptions:t});}getQueryDefaults(r){let t=[...a(this,ot).values()],e={};return t.forEach(s=>{et(r,s.queryKey)&&Object.assign(e,s.defaultOptions);}),e}setMutationDefaults(r,t){a(this,ut).set(Y(r),{mutationKey:r,defaultOptions:t});}getMutationDefaults(r){let t=[...a(this,ut).values()],e={};return t.forEach(s=>{et(r,s.mutationKey)&&Object.assign(e,s.defaultOptions);}),e}defaultQueryOptions(r){if(r._defaulted)return r;let t={...a(this,L).queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:true};return t.queryHash||(t.queryHash=mt(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===tt&&(t.enabled=false),t}defaultMutationOptions(r){return r?._defaulted?r:{...a(this,L).mutations,...r?.mutationKey&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:true}}clear(){a(this,y).clear(),a(this,K).clear();}},y=new WeakMap,K=new WeakMap,L=new WeakMap,ot=new WeakMap,ut=new WeakMap,_=new WeakMap,ct=new WeakMap,lt=new WeakMap,he);exports.DkanApiClient=dt;exports.DkanApiError=C;exports.DkanClient=Qt;exports.QueryClient=pe;return exports;})({});//# sourceMappingURL=index.global.min.js.map
//# sourceMappingURL=index.global.min.js.map